<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; script-src 'self' 'unsafe-inline';">
    <title>Profile - Threads</title>
    <link rel="stylesheet" href="profile.css">
    <link rel="stylesheet" href="sidebar.css">
    <style>
        .profile-card {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .profile-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .profile-username {
            font-size: 15px;
            color: #000000;
        }

        .profile-avatar {
            width: 84px;
            height: 84px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-bio {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 16px;
            color: #000000;
        }

        .profile-interest-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
            padding: 8px 0;
        }

        .profile-interest-tags:empty {
            display: none;
        }

        .interest-tag {
            padding: 8px 16px;
            border-radius: 45px;
            border: 0.5px solid rgba(0, 0, 0, 0.15);
            background-color: rgb(255, 255, 255);
            font-size: 13px;
            line-height: 21px;
            color: rgb(153, 153, 153);
            cursor: pointer;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            transition: transform 0.2s;
            -webkit-font-smoothing: antialiased;
        }

        .interest-tag:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .interest-tag-add {
            padding: 8px 16px;
            border-radius: 45px;
            border: 0.5px solid rgba(0, 0, 0, 0.15);
            background-color: rgb(255, 255, 255);
            font-size: 13px;
            line-height: 21px;
            color: rgb(153, 153, 153);
            cursor: pointer;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            transition: transform 0.2s;
            -webkit-font-smoothing: antialiased;
        }

        .interest-tag-add:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .interest-tag {
            border-color: rgba(255, 255, 255, 0.15);
            background-color: #000;
            color: #777;
        }

        [data-theme="dark"] .interest-tag:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .interest-tag-add {
            border-color: rgba(255, 255, 255, 0.15);
            background-color: #000;
            color: #777;
        }

        [data-theme="dark"] .interest-tag-add:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .profile-stats-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .profile-followers {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .follower-avatars {
            display: flex;
            align-items: center;
        }

        .follower-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #ffffff;
            margin-left: -6px;
            object-fit: cover;
        }

        .follower-avatar:first-child {
            margin-left: 0;
        }

        .follower-count {
            font-size: 15px;
            color: #999999;
        }

        .profile-icons {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .profile-icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #000000;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .edit-profile-btn {
            width: 100%;
            padding: 14px;
            background: transparent;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: #000000;
        }

        .edit-profile-btn:hover {
            background-color: #f5f5f5;
        }

        .profile-tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .profile-tab {
            flex: 1;
            padding: 16px;
            background: none;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: #999999;
            border-bottom: 1px solid transparent;
            transition: all 0.2s;
            margin-bottom: -1px;
        }

        .profile-tab:hover {
            color: #000000;
        }

        .profile-tab.active {
            color: #000000;
            border-bottom-color: #000000;
        }

        /* Profile Composer */
        .profile-composer {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            gap: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .profile-composer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-composer-input {
            flex: 1;
            font-size: 15px;
            color: #999999;
            cursor: pointer;
        }

        .profile-composer-btn {
            padding: 12px 24px;
            background: #000;
            border: none;
            border-radius: 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            color: #fff;
        }

        .profile-composer-btn:hover {
            opacity: 0.85;
        }

        /* Profile Feed */
        .profile-feed {
            padding: 0;
        }

        .profile-post {
            display: flex;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
            gap: 12px;
        }

        .profile-post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-post-content {
            flex: 1;
        }

        .profile-post-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .profile-post-username {
            font-size: 15px;
            font-weight: 600;
        }

        .profile-post-time {
            font-size: 14px;
            color: #999999;
        }

        .profile-post-menu {
            margin-left: auto;
            position: relative;
        }

        .post-menu-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #999999;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-menu-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .post-menu-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            min-width: 240px;
            padding: 8px;
            z-index: 1000;
        }

        .post-menu-dropdown.active {
            display: block;
        }

        .post-menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 14px 16px;
            background: none;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            color: #000000;
            text-align: left;
        }

        .post-menu-item:hover {
            background-color: #f5f5f5;
        }

        .post-menu-item.delete {
            color: #ed4956;
        }

        .post-menu-item svg {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        [data-theme="dark"] .post-menu-dropdown {
            background-color: #262626;
        }

        [data-theme="dark"] .profile-card {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .profile-username {
            color: #f5f5f5;
        }

        [data-theme="dark"] .profile-bio {
            color: #f5f5f5;
        }

        [data-theme="dark"] .follower-avatar {
            border-color: #101010;
        }

        [data-theme="dark"] .follower-count {
            color: #999999;
        }

        [data-theme="dark"] .profile-icon-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .edit-profile-btn {
            border-color: rgba(255, 255, 255, 0.15);
            color: #f5f5f5;
        }

        [data-theme="dark"] .edit-profile-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .profile-tabs {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .profile-tab {
            color: #999999;
        }

        [data-theme="dark"] .profile-tab:hover {
            color: #f5f5f5;
        }

        [data-theme="dark"] .profile-tab.active {
            color: #f5f5f5;
            border-bottom-color: #f5f5f5;
        }

        [data-theme="dark"] .profile-composer {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .profile-composer-input {
            color: #999999;
        }

        [data-theme="dark"] .profile-composer-btn {
            background: #fff;
            color: #000;
        }

        [data-theme="dark"] .profile-composer-btn:hover {
            opacity: 0.85;
        }

        [data-theme="dark"] .profile-post {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .profile-post-username {
            color: #f5f5f5;
        }

        [data-theme="dark"] .profile-post-time {
            color: #999999;
        }

        [data-theme="dark"] .post-menu-btn {
            color: #999999;
        }

        [data-theme="dark"] .post-menu-item {
            color: #f5f5f5;
        }

        [data-theme="dark"] .post-menu-item:hover {
            background-color: #333;
        }

        [data-theme="dark"] .profile-post-text {
            color: #f5f5f5;
        }

        [data-theme="dark"] .profile-action-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .profile-post-stats {
            color: #999999;
        }

        [data-theme="dark"] .empty-state {
            color: #999999;
        }

        [data-theme="light"] .profile-post-text {
            color: #000;
        }

        .profile-post-text {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .profile-post-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
        }


        .profile-post-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .profile-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #000000;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-post-stats {
            font-size: 14px;
            color: #999999;
            margin-top: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999999;
        }

        .empty-state p {
            font-size: 15px;
        }

        /* Repost styles */
        .profile-verified-badge {
            display: inline-flex;
            align-items: center;
            margin-left: 2px;
        }

        .profile-repost-icon {
            display: inline-flex;
            align-items: center;
            color: #999;
            margin-left: 2px;
        }

        .profile-repost-quote {
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .profile-repost-quote-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .profile-repost-quote-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-repost-quote-name {
            font-size: 13px;
            font-weight: 600;
        }

        .profile-repost-quote-text {
            font-size: 14px;
            line-height: 1.4;
            margin: 0;
        }

        .profile-repost-stats {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 8px;
        }

        .repost-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: #999;
        }

        .repost-stat.liked {
            color: #ff3040;
        }

        .repost-stat svg {
            width: 16px;
            height: 16px;
        }

        [data-theme="dark"] .profile-repost-quote {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .profile-repost-quote-name {
            color: #f5f5f5;
        }

        [data-theme="dark"] .profile-repost-quote-text {
            color: #ccc;
        }

        [data-theme="dark"] .repost-stat {
            color: #777;
        }

        [data-theme="dark"] .repost-stat.liked {
            color: #ff3040;
        }

        /* Media Grid */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            padding: 0;
        }

        .media-grid-item {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            cursor: pointer;
        }

        .media-grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: opacity 0.2s;
        }

        .media-grid-item:hover img {
            opacity: 0.85;
        }

        .media-grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            background: rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .media-grid-item:hover .media-grid-overlay {
            opacity: 1;
        }

        .media-grid-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #fff;
            font-size: 14px;
            font-weight: 600;
        }

        .media-grid-stat svg {
            width: 18px;
            height: 18px;
        }

        /* Edit Profile Modal */
        .edit-profile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .edit-profile-overlay.active {
            display: flex;
            align-items: flex-end;
        }

        .edit-profile-modal {
            background: #fff;
            border-radius: 16px 16px 0 0;
            width: 100%;
            max-width: 620px;
            height: 100%;
            overflow-y: auto;
            padding: 32px;
            position: relative;
            scrollbar-width: none;
        }

        .edit-profile-modal::-webkit-scrollbar {
            display: none;
        }

        .edit-profile-section {
            padding: 16px 0;
        }

        .edit-label {
            display: block;
            font-size: 16px;
            font-weight: 700;
            color: #000;
            margin-bottom: 8px;
        }

        .edit-profile-name-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .edit-name-value {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
            color: #000;
        }

        .edit-name-value svg {
            color: #999;
        }

        .edit-profile-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
        }

        .edit-bio-input {
            width: 100%;
            border: none;
            outline: none;
            font-size: 15px;
            color: #000;
            font-family: inherit;
            resize: none;
            line-height: 1.5;
            background: transparent;
        }

        .edit-row-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .edit-row-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-privacy-value {
            font-size: 15px;
            color: #999;
        }

        .edit-placeholder {
            font-size: 15px;
            color: #999;
        }

        .edit-hint {
            font-size: 13px;
            color: #999;
            line-height: 1.4;
            margin-top: 4px;
        }

        .edit-divider {
            height: 1px;
            background: #eee;
        }

        .toggle-switch {
            width: 48px;
            height: 28px;
            background: #e0e0e0;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #000;
        }

        .toggle-knob {
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-knob {
            transform: translateX(20px);
        }

        .edit-profile-footer {
            padding: 16px 0 0;
        }

        .edit-done-btn {
            width: 100%;
            padding: 16px;
            background: #000;
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 52px;
        }

        .edit-done-btn:hover {
            background: #333;
        }

        .edit-done-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .edit-done-spinner {
            width: 20px;
            height: 20px;
            border: 2.5px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: edit-spin 0.6s linear infinite;
        }

        @keyframes edit-spin {
            to { transform: rotate(360deg); }
        }

        [data-theme="dark"] .edit-done-spinner {
            border-color: rgba(0, 0, 0, 0.3);
            border-top-color: #000;
        }

        [data-theme="dark"] .edit-profile-modal {
            background: #181818;
        }

        [data-theme="dark"] .edit-label {
            color: #f5f5f5;
        }

        [data-theme="dark"] .edit-name-value {
            color: #f5f5f5;
        }

        [data-theme="dark"] .edit-bio-input {
            color: #f5f5f5;
        }

        [data-theme="dark"] .edit-divider {
            background: #333;
        }

        [data-theme="dark"] .edit-done-btn {
            background: #f5f5f5;
            color: #000;
        }

        [data-theme="dark"] .edit-done-btn:hover {
            background: #ddd;
        }

        /* Interests Modal */
        .interests-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .interests-modal-overlay.active {
            display: flex;
        }

        .interests-modal {
            background: #fff;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
        }

        .interests-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .interests-back-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #000000;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .interests-modal-title {
            font-size: 16px;
            font-weight: 700;
        }

        .interests-header-spacer {
            width: 32px;
        }

        .interests-modal-content {
            padding: 20px;
        }

        .interests-input {
            width: 100%;
            padding: 16px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            background: transparent;
            color: #000000;
            outline: none;
        }

        .interests-input::placeholder {
            color: #999999;
        }

        .interests-input:focus {
            border-color: #000000;
        }

        .interests-hint {
            font-size: 14px;
            color: #999999;
            margin-top: 16px;
            text-align: center;
        }

        [data-theme="dark"] .interests-back-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .interests-modal {
            background: #181818;
        }

        [data-theme="dark"] .interests-input {
            color: #f5f5f5;
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .interests-input:focus {
            border-color: #f5f5f5;
        }

        [data-theme="dark"] .interests-suggestions {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .interests-suggestion-item {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .interests-suggestion-item:hover {
            background-color: #262626;
        }

        [data-theme="dark"] .interests-suggestion-name {
            color: #f5f5f5;
        }

        [data-theme="dark"] .interests-selected-item {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .interests-selected-name {
            color: #f5f5f5;
        }

        [data-theme="dark"] .interests-remove-btn:hover {
            color: #f5f5f5;
        }

        [data-theme="dark"] .interests-display {
            color: #f5f5f5;
        }

        .interests-input-container {
            position: relative;
        }

        .interests-suggestions {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 10;
        }

        .interests-suggestions.active {
            display: block;
        }

        .interests-suggestion-item {
            display: flex;
            flex-direction: column;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .interests-suggestion-item:last-child {
            border-bottom: none;
        }

        .interests-suggestion-item:hover {
            background-color: #f5f5f5;
        }

        .interests-suggestion-name {
            font-size: 15px;
            font-weight: 600;
            color: #000000;
        }

        .interests-suggestion-posts {
            font-size: 13px;
            color: #999999;
            margin-top: 2px;
        }

        [data-theme="dark"] .interests-suggestions {
            background: #181818;
        }

        .interests-selected-list {
            margin-top: 16px;
        }

        .interests-selected-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .interests-selected-name {
            font-size: 15px;
            font-weight: 500;
            color: #000000;
        }

        .interests-remove-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #999999;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .interests-remove-btn:hover {
            color: #000000;
        }

        .interests-display {
            font-size: 15px;
            color: #000000;
        }

        .interests-display.placeholder {
            color: #999999;
        }

        /* Links Modal */
        .links-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .links-modal-overlay.active {
            display: flex;
        }

        .links-modal {
            background: #fff;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        }

        .links-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .links-back-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #000000;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .links-modal-title {
            font-size: 16px;
            font-weight: 700;
        }

        .links-header-spacer {
            width: 32px;
        }

        .links-modal-content {
            padding: 16px;
        }

        .links-list-view {
            display: block;
        }

        .links-add-view {
            display: none;
        }

        .links-add-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            cursor: pointer;
            background: none;
            width: 100%;
            font-family: inherit;
        }

        .links-add-row:hover {
            background-color: #f5f5f5;
        }

        .links-add-row-icon {
            color: #000000;
            flex-shrink: 0;
        }

        .links-add-row-text {
            font-size: 15px;
            font-weight: 500;
            color: #000000;
        }

        .links-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .links-card-icon {
            color: #000000;
            flex-shrink: 0;
        }

        .links-card-info {
            flex: 1;
            min-width: 0;
        }

        .links-card-title {
            font-size: 15px;
            font-weight: 700;
            color: #000000;
            line-height: 1.3;
        }

        .links-card-url {
            font-size: 13px;
            color: #999999;
            line-height: 1.3;
            margin-top: 1px;
        }

        .links-card-remove {
            background: none;
            border: none;
            cursor: pointer;
            color: #999999;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .links-card-remove:hover {
            color: #000000;
        }

        .links-done-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #000000;
            padding: 4px;
        }

        .links-add-form {
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            overflow: hidden;
        }

        .links-add-form-field {
            padding: 14px 16px;
        }

        .links-add-form-field:first-child {
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .links-add-form-input {
            width: 100%;
            border: none;
            font-size: 15px;
            font-family: inherit;
            background: transparent;
            color: #000000;
            outline: none;
            padding: 0;
        }

        .links-add-form-input::placeholder {
            color: #999999;
        }

        .links-done-btn.disabled {
            color: #cccccc;
            pointer-events: none;
        }

        .links-error {
            display: none;
            font-size: 14px;
            color: #ff3b30;
            margin-top: 12px;
            text-align: center;
        }

        .links-error.show {
            display: block;
        }

        .links-hint {
            font-size: 14px;
            color: #999999;
            margin-top: 16px;
            text-align: center;
        }

        .links-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #000000;
            color: #ffffff;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .links-toast.show {
            opacity: 1;
        }

        [data-theme="dark"] .links-modal {
            background: #181818;
        }

        [data-theme="dark"] .links-back-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-modal-title {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-modal-header {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .links-add-row {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .links-add-row:hover {
            background-color: #262626;
        }

        [data-theme="dark"] .links-add-row-icon {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-add-row-text {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-card {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .links-card-icon {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-card-title {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-card-remove:hover {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-done-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .links-done-btn.disabled {
            color: #555555;
        }

        [data-theme="dark"] .links-add-form {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .links-add-form-field:first-child {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .links-add-form-input {
            color: #f5f5f5;
        }

        .links-display {
            font-size: 16px;
            color: #999999;
        }

        .links-selected-list {
            margin-bottom: 8px;
        }

        /* Podcast Modal */
        .podcast-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }

        .podcast-modal-overlay.active {
            display: flex;
        }

        .podcast-modal {
            background: #fff;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        }

        .podcast-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .podcast-back-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #000000;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podcast-modal-title {
            font-size: 16px;
            font-weight: 700;
        }

        .podcast-done-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #000000;
            padding: 4px;
        }

        .podcast-done-btn.disabled {
            color: #cccccc;
            pointer-events: none;
        }

        .podcast-modal-content {
            padding: 16px;
        }

        .podcast-description {
            font-size: 15px;
            color: #999999;
            margin-bottom: 16px;
        }

        .podcast-form {
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            overflow: hidden;
        }

        .podcast-form-field {
            padding: 14px 16px;
        }

        .podcast-form-input {
            width: 100%;
            border: none;
            font-size: 15px;
            font-family: inherit;
            background: transparent;
            color: #000000;
            outline: none;
            padding: 0;
        }

        .podcast-form-input::placeholder {
            color: #999999;
        }

        .podcast-error {
            display: none;
            font-size: 14px;
            color: #ff3b30;
            margin-top: 12px;
            text-align: center;
        }

        .podcast-error.show {
            display: block;
        }

        .podcast-hint {
            font-size: 14px;
            color: #999999;
            margin-top: 16px;
            text-align: center;
        }

        .podcast-display {
            font-size: 16px;
            color: #999999;
        }

        [data-theme="dark"] .podcast-modal {
            background: #181818;
        }

        [data-theme="dark"] .podcast-back-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .podcast-modal-title {
            color: #f5f5f5;
        }

        [data-theme="dark"] .podcast-modal-header {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .podcast-done-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .podcast-done-btn.disabled {
            color: #555555;
        }

        [data-theme="dark"] .podcast-form {
            border-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .podcast-form-input {
            color: #f5f5f5;
        }

        /* Reply Thread Layout */
        .reply-thread {
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }

        .reply-thread-original {
            display: flex;
            padding: 16px 20px 0 20px;
            gap: 12px;
            position: relative;
        }

        .reply-thread-original .reply-avatar-col {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .reply-thread-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .reply-thread-line {
            width: 2px;
            flex: 1;
            background-color: rgba(0, 0, 0, 0.15);
            margin-top: 8px;
            margin-bottom: 8px;
            border-radius: 1px;
        }

        .reply-thread-content {
            flex: 1;
            min-width: 0;
        }

        .reply-thread-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .reply-thread-username {
            font-size: 15px;
            font-weight: 600;
        }

        .reply-thread-verified {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        .reply-thread-time {
            font-size: 14px;
            color: #999999;
        }

        .reply-thread-menu {
            margin-left: auto;
            position: relative;
        }

        .reply-thread-text {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .reply-thread-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .reply-thread-actions {
            display: flex;
            align-items: center;
            gap: 16px;
            padding-bottom: 12px;
        }

        .reply-thread-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #000000;
            padding: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
        }

        .reply-thread-action-btn svg {
            width: 20px;
            height: 20px;
        }

        .reply-thread-action-count {
            color: #999;
            font-size: 13px;
        }

        /* Reply (user's own reply) */
        .reply-thread-reply {
            display: flex;
            padding: 0 20px 16px 20px;
            gap: 12px;
        }

        .reply-thread-reply .reply-thread-actions {
            padding-bottom: 0;
        }

        /* Dark mode */
        [data-theme="dark"] .reply-thread {
            border-bottom-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .reply-thread-line {
            background-color: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] .reply-thread-username {
            color: #f5f5f5;
        }

        [data-theme="dark"] .reply-thread-time {
            color: #999999;
        }

        [data-theme="dark"] .reply-thread-text {
            color: #f5f5f5;
        }

        [data-theme="dark"] .reply-thread-action-btn {
            color: #f5f5f5;
        }

        [data-theme="dark"] .reply-thread-action-count {
            color: #777;
        }

        /* Light mode */
        [data-theme="light"] .reply-thread-username {
            color: #000;
        }

        [data-theme="light"] .reply-thread-text {
            color: #000;
        }

        [data-theme="light"] .reply-thread-action-btn {
            color: #000;
        }

        @media (max-width: 700px) {
            .post-menu-dropdown {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                min-width: auto;
                border-radius: 18px 18px 0 0;
                margin-top: 0;
                z-index: 1001;
                padding: 14px;
                box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.15);
                animation: slideUpMenu 0.3s ease-out;
            }

            .post-menu-dropdown.active {
                display: block;
            }

            .post-menu-item {
                background-color: #f5f5f5;
                border-radius: 12px;
                margin-bottom: 2px;
                font-weight: 500;
            }

            .post-menu-item:first-child {
                border-radius: 12px 12px 4px 4px;
            }

            .post-menu-item:last-child {
                border-radius: 4px 4px 12px 12px;
                margin-bottom: 0;
            }

            .post-menu-item:only-child {
                border-radius: 12px;
            }

            .post-menu-item.delete {
                margin-top: 10px;
                border-radius: 12px;
            }

            .post-menu-item:hover {
                background-color: #e8e8e8;
            }

            [data-theme="dark"] .post-menu-dropdown {
                background-color: #1c1c1c;
                box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.4);
            }

            [data-theme="dark"] .post-menu-item {
                background-color: #262626;
                color: #f5f5f5;
            }

            [data-theme="dark"] .post-menu-item:hover {
                background-color: #333;
            }

            [data-theme="dark"] .post-menu-item.delete {
                color: #ed4956;
            }

            @keyframes slideUpMenu {
                from { transform: translateY(100%); }
                to { transform: translateY(0); }
            }
        }

    </style>
    <script>
        (function() {
            let raw = localStorage.getItem('threads_theme');
            let savedTheme = 'auto';
            if (raw) savedTheme = JSON.parse(raw);
            if (savedTheme == 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            } else if (savedTheme == 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                if (!window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'light');
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            }
        })();
    </script>
</head>
<body>
    <div class="app">
        <!-- Left Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-top">
                <a href="index.html" class="logo-link">
                    <img src="icons/logo.svg" width="30" height="34" alt="Threads" class="logo">
                </a>
            </div>

            <div class="sidebar-menu">
                <button class="nav-btn" data-tab="home" title="Home">
                    <img src="icons/home.svg" width="26" height="26" alt="Home">
                </button>
                <button class="nav-btn" data-tab="search" title="Search">
                    <img src="icons/search.svg" width="26" height="26" alt="Search">
                </button>
                <button class="nav-btn" data-tab="create" title="Create">
                    <img src="icons/create.svg" width="26" height="26" alt="Create">
                </button>
                <button class="nav-btn" data-tab="activity" title="Activity">
                    <img src="icons/heart.svg" width="26" height="26" alt="Activity">
                </button>
                <button class="nav-btn active" data-tab="profile" title="Profile">
                    <img src="icons/profile.svg" width="26" height="26" alt="Profile">
                </button>
            </div>

            <div class="sidebar-bottom">
                <button class="nav-btn" id="pinBtn" title="Pin">
                    <img src="icons/pin.svg" width="26" height="26" alt="Pin">
                </button>
                <div class="menu-btn-container">
                    <button class="nav-btn" id="menuBtn" title="Menu">
                        <img src="icons/menu.svg" width="26" height="26" alt="Menu">
                    </button>
                    <div class="menu-dropdown" id="menuDropdown">
                        <!-- Main Menu -->
                        <div class="menu-main" id="menuMain">
                            <div class="menu-section">
                                <button class="menu-item has-arrow" id="appearanceBtn">
                                    Appearance
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="9 18 15 12 9 6"/>
                                    </svg>
                                </button>
                                <button class="menu-item">Insights</button>
                                <button class="menu-item">Settings</button>
                            </div>
                            <div class="menu-divider"></div>
                            <div class="menu-section">
                                <button class="menu-item has-arrow" id="menuFeedsBtn">
                                    Feeds
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="9 18 15 12 9 6"/>
                                    </svg>
                                </button>
                                <button class="menu-item">Saved</button>
                                <button class="menu-item">Liked</button>
                            </div>
                            <div class="menu-divider"></div>
                            <div class="menu-section">
                                <button class="menu-item">Report a problem</button>
                                <button class="menu-item logout" id="logoutBtn">Log out</button>
                            </div>
                        </div>
                        <!-- Appearance Submenu -->
                        <div class="menu-submenu" id="menuAppearanceSubmenu">
                            <div class="submenu-header">
                                <button class="submenu-back" id="appearanceBackBtn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="15 18 9 12 15 6"/>
                                    </svg>
                                </button>
                                <span class="submenu-title">Appearance</span>
                                <div class="submenu-spacer"></div>
                            </div>
                            <div class="appearance-options">
                                <button class="appearance-option active" data-theme="light">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="12" cy="12" r="4"/>
                                        <line x1="12" y1="2" x2="12" y2="4"/>
                                        <line x1="12" y1="20" x2="12" y2="22"/>
                                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                        <line x1="2" y1="12" x2="4" y2="12"/>
                                        <line x1="20" y1="12" x2="22" y2="12"/>
                                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                                    </svg>
                                </button>
                                <button class="appearance-option" data-theme="dark">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                                    </svg>
                                </button>
                                <button class="appearance-option" data-theme="auto">
                                    Auto
                                </button>
                            </div>
                        </div>
                        <!-- Feeds Submenu -->
                        <div class="menu-submenu" id="menuFeedsSubmenu">
                            <div class="submenu-header">
                                <button class="submenu-back" id="menuFeedsBackBtn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="15 18 9 12 15 6"/>
                                    </svg>
                                </button>
                                <span class="submenu-title">Feeds</span>
                                <button class="submenu-add">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <circle cx="10" cy="10" r="7.5"/>
                                        <line x1="10" y1="6.5" x2="10" y2="13.5"/>
                                        <line x1="6.5" y1="10" x2="13.5" y2="10"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="menu-feeds-list">
                                <button class="menu-item" data-feed="foryou">For you</button>
                                <button class="menu-item" data-feed="following">Following</button>
                                <button class="menu-item" data-feed="ghost">
                                    Ghost posts
                                    <svg width="20" height="20" viewBox="0 0 20 19" fill="currentColor">
                                        <path d="M4.60249 16.4045C4.86284 16.0252 5.38193 15.9287 5.76134 16.1888C6.1495 16.4552 6.56424 16.6861 6.99995 16.8765C7.4757 17.0843 7.97782 17.2443 8.49897 17.3501C8.94984 17.4417 9.24062 17.8823 9.1492 18.3332C9.0575 18.784 8.61788 19.0757 8.16694 18.9842C7.52911 18.8547 6.9149 18.6584 6.33263 18.404C5.79943 18.171 5.29237 17.8888 4.81814 17.5633C4.43901 17.3028 4.34214 16.7838 4.60249 16.4045Z"></path>
                                        <path d="M14.2379 16.1888C14.6172 15.9285 15.1362 16.0253 15.3968 16.4045C15.6572 16.7839 15.5606 17.3029 15.1811 17.5633C14.7068 17.8888 14.1999 18.171 13.6666 18.404C13.0843 18.6584 12.4702 18.8547 11.8323 18.9842C11.3814 19.0756 10.9408 18.784 10.8492 18.3332C10.7579 17.8824 11.0496 17.4418 11.5003 17.3501C12.0215 17.2443 12.5235 17.0843 12.9993 16.8765C13.4351 16.686 13.8497 16.4553 14.2379 16.1888Z"></path>
                                        <path d="M1.6671 10.8503C2.11797 10.7587 2.55758 11.0506 2.64936 11.5013C2.75515 12.0225 2.91515 12.5246 3.12299 13.0003C3.31653 13.4433 3.55247 13.8647 3.82449 14.2585C4.08586 14.6371 3.99064 15.1558 3.61209 15.4173C3.23352 15.6786 2.71482 15.5841 2.45323 15.2057C2.12096 14.7248 1.83313 14.2096 1.5963 13.6676C1.34194 13.0854 1.14555 12.4711 1.01606 11.8333C0.924746 11.3825 1.21638 10.942 1.6671 10.8503Z"></path>
                                        <path d="M9.99962 0.833984C15.0621 0.833995 19.1661 4.93817 19.1663 10.0007C19.1663 10.6273 19.1035 11.2407 18.9832 11.8333C18.8537 12.4712 18.6574 13.0853 18.4029 13.6676C18.1661 14.2098 17.8784 14.7247 17.546 15.2057C17.2844 15.5842 16.7657 15.6787 16.3872 15.4173C16.0089 15.1557 15.9135 14.637 16.1748 14.2585C16.4469 13.8646 16.6827 13.4434 16.8762 13.0003C17.0841 12.5245 17.2441 12.0226 17.3499 11.5013C17.4481 11.0172 17.4996 10.5153 17.4996 10.0007C17.4995 5.85864 14.1417 2.50066 9.99962 2.50065C8.8214 2.50071 7.70832 2.77171 6.71837 3.25423L6.5963 3.30225C6.4708 3.34043 6.33684 3.34834 6.20649 3.32503L2.70307 2.69922L3.33865 6.17334C3.3709 6.34936 3.34609 6.53119 3.26704 6.69173C2.93406 7.3678 2.69972 8.10131 2.58344 8.87354C2.51495 9.32865 2.09048 9.64271 1.63536 9.57422C1.18062 9.50551 0.867211 9.08097 0.935494 8.62614C1.06319 7.77778 1.30818 6.96719 1.65164 6.21159L0.846789 1.81706C0.797783 1.54853 0.882883 1.27241 1.07547 1.07894C1.26812 0.885461 1.54399 0.799138 1.81277 0.847005L6.24148 1.63883C7.38929 1.12218 8.66189 0.834039 9.99962 0.833984Z"></path>
                                        <path d="M13.1572 10.974C13.4826 10.6486 14.0101 10.6485 14.3356 10.974C14.6608 11.2994 14.6609 11.8269 14.3356 12.1523C13.7273 12.7606 12.87 13.0214 12.0797 13.0215C11.2894 13.0215 10.4321 12.7606 9.82384 12.1523C9.4984 11.8269 9.4984 11.2994 9.82384 10.974C10.1493 10.6486 10.6768 10.6485 11.0022 10.974C11.2273 11.1989 11.6202 11.3548 12.0797 11.3548C12.5392 11.3548 12.9322 11.1989 13.1572 10.974Z"></path>
                                        <path d="M14.7913 7.81966C15.3664 7.82039 15.8318 8.28705 15.8313 8.86214C15.8306 9.43723 15.364 9.90285 14.7888 9.90218C14.2137 9.9016 13.7482 9.43482 13.7488 8.8597C13.7494 8.28458 14.2162 7.8191 14.7913 7.81966Z"></path>
                                        <path d="M9.37543 7.81315C9.95079 7.81371 10.4169 8.28038 10.4163 8.85563C10.4157 9.43071 9.94895 9.89624 9.37381 9.89567C8.79875 9.89509 8.33245 9.42827 8.33295 8.85319C8.33372 8.27828 8.80075 7.81275 9.37543 7.81315Z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Top Bar -->
        <div class="mobile-top-bar">
            <div class="mobile-top-spacer"></div>
            <a href="index.html" class="mobile-top-logo">
                <img src="icons/logo.svg" width="28" height="32" alt="Threads">
            </a>
            <div class="mobile-menu-container">
                <button class="mobile-top-menu" id="mobileMenuBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <rect rx="1.25" x="3" y="7" width="18" height="2.5"></rect>
                        <rect rx="1.25" x="10" y="15" width="11" height="2.5"></rect>
                    </svg>
                </button>
                <div class="menu-dropdown" id="mobileMenuDropdown">
                    <div class="menu-main" id="mobileMenuMain">
                        <div class="menu-section">
                            <button class="menu-item has-arrow" id="mobileAppearanceBtn">
                                Appearance
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </button>
                            <button class="menu-item">Insights</button>
                            <button class="menu-item">Settings</button>
                        </div>
                        <div class="menu-divider"></div>
                        <div class="menu-section">
                            <button class="menu-item has-arrow" id="mobileFeedsBtn">
                                Feeds
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </button>
                            <button class="menu-item">Saved</button>
                            <button class="menu-item">Liked</button>
                        </div>
                        <div class="menu-divider"></div>
                        <div class="menu-section">
                            <button class="menu-item">Report a problem</button>
                            <button class="menu-item logout" id="mobileLogoutBtn">Log out</button>
                        </div>
                    </div>
                    <!-- Appearance Submenu -->
                    <div class="menu-submenu" id="mobileAppearanceSubmenu">
                        <div class="submenu-header">
                            <button class="submenu-back" id="mobileAppearanceBackBtn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <span class="submenu-title">Appearance</span>
                            <div class="submenu-spacer"></div>
                        </div>
                        <div class="appearance-options">
                            <button class="appearance-option active" data-theme="light">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="4"></circle>
                                    <line x1="12" y1="2" x2="12" y2="4"></line>
                                    <line x1="12" y1="20" x2="12" y2="22"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="2" y1="12" x2="4" y2="12"></line>
                                    <line x1="20" y1="12" x2="22" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                            <button class="appearance-option" data-theme="dark">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                            </button>
                            <button class="appearance-option" data-theme="auto">
                                Auto
                            </button>
                        </div>
                    </div>
                    <!-- Feeds Submenu -->
                    <div class="menu-submenu" id="mobileFeedsSubmenu">
                        <div class="submenu-header">
                            <button class="submenu-back" id="mobileFeedsBackBtn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <span class="submenu-title">Feeds</span>
                            <button class="submenu-add">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="10" cy="10" r="7.5"></circle>
                                    <line x1="10" y1="6.5" x2="10" y2="13.5"></line>
                                    <line x1="6.5" y1="10" x2="13.5" y2="10"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="menu-feeds-list">
                            <button class="menu-item" data-feed="foryou">For you</button>
                            <button class="menu-item" data-feed="following">Following</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">

            <div class="content-wrapper">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="profile-top">
                        <div class="profile-details">
                            <h1 class="profile-name" id="profileName"></h1>
                            <span class="profile-username" id="profileUsername"></span>
                        </div>
                        <img src="" alt="avatar" class="profile-avatar" id="profileAvatar">
                    </div>
                    <p class="profile-bio" id="profileBio"></p>
                    <div class="profile-stats-row">
                        <div class="profile-followers">
                            <div class="follower-avatars">
                                <img src="images/avatar2.jpg" alt="" class="follower-avatar">
                                <img src="images/avatar3.jpg" alt="" class="follower-avatar">
                                <img src="images/avatar4.jpg" alt="" class="follower-avatar">
                            </div>
                            <span class="follower-count" id="followerCount">33 followers</span>
                        </div>
                        <div class="profile-icons">
                            <button class="profile-icon-btn" title="Insights" onclick="window.location.href='insights.html'">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <rect fill="none" height="20" rx="5" stroke="currentColor" stroke-width="2" width="20" x="2" y="2"></rect>
                                    <rect height="12" rx="1" width="2" x="11" y="6"></rect>
                                    <rect height="9" rx="1" width="2" x="15" y="9"></rect>
                                    <rect height="5" rx="1" width="2" x="7" y="13"></rect>
                                </svg>
                            </button>
                            <button class="profile-icon-btn" title="Instagram">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2.982c2.937 0 3.285.011 4.445.064a6.087 6.087 0 0 1 2.042.379 3.408 3.408 0 0 1 1.265.823 3.408 3.408 0 0 1 .823 1.265 6.087 6.087 0 0 1 .379 2.042c.053 1.16.064 1.508.064 4.445s-.011 3.285-.064 4.445a6.087 6.087 0 0 1-.379 2.042 3.643 3.643 0 0 1-2.088 2.088 6.087 6.087 0 0 1-2.042.379c-1.16.053-1.508.064-4.445.064s-3.285-.011-4.445-.064a6.087 6.087 0 0 1-2.043-.379 3.408 3.408 0 0 1-1.264-.823 3.408 3.408 0 0 1-.823-1.265 6.087 6.087 0 0 1-.379-2.042c-.053-1.16-.064-1.508-.064-4.445s.011-3.285.064-4.445a6.087 6.087 0 0 1 .379-2.042 3.408 3.408 0 0 1 .823-1.265 3.408 3.408 0 0 1 1.265-.823 6.087 6.087 0 0 1 2.042-.379c1.16-.053 1.508-.064 4.445-.064M12 1c-2.987 0-3.362.013-4.535.066a8.074 8.074 0 0 0-2.67.511 5.392 5.392 0 0 0-1.949 1.27 5.392 5.392 0 0 0-1.269 1.948 8.074 8.074 0 0 0-.51 2.67C1.012 8.638 1 9.013 1 12s.013 3.362.066 4.535a8.074 8.074 0 0 0 .511 2.67 5.392 5.392 0 0 0 1.27 1.949 5.392 5.392 0 0 0 1.948 1.269 8.074 8.074 0 0 0 2.67.51C8.638 22.988 9.013 23 12 23s3.362-.013 4.535-.066a8.074 8.074 0 0 0 2.67-.511 5.625 5.625 0 0 0 3.218-3.218 8.074 8.074 0 0 0 .51-2.67C22.988 15.362 23 14.987 23 12s-.013-3.362-.066-4.535a8.074 8.074 0 0 0-.511-2.67 5.392 5.392 0 0 0-1.27-1.949 5.392 5.392 0 0 0-1.948-1.269 8.074 8.074 0 0 0-2.67-.51C15.362 1.012 14.987 1 12 1Zm0 5.351A5.649 5.649 0 1 0 17.649 12 5.649 5.649 0 0 0 12 6.351Zm0 9.316A3.667 3.667 0 1 1 15.667 12 3.667 3.667 0 0 1 12 15.667Zm5.872-10.859a1.32 1.32 0 1 0 1.32 1.32 1.32 1.32 0 0 0-1.32-1.32Z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button class="edit-profile-btn" id="editProfileBtn">Edit profile</button>
                </div>

                <!-- Profile Tabs -->
                <div class="profile-tabs">
                    <button class="profile-tab active" data-tab="threads">Threads</button>
                    <button class="profile-tab" data-tab="replies">Replies</button>
                    <button class="profile-tab" data-tab="media">Media</button>
                    <button class="profile-tab" data-tab="reposts">Reposts</button>
                </div>

                <!-- Profile Composer -->
                <div class="profile-composer" id="profileComposer">
                    <img src="" alt="avatar" class="profile-composer-avatar" id="composerAvatar">
                    <span class="profile-composer-input">What's new?</span>
                    <button class="profile-composer-btn">Post</button>
                </div>

                <!-- Profile Feed -->
                <div class="profile-feed" id="profileFeed">
                </div>

                <!-- Replies Feed -->
                <div class="replies-feed" id="repliesFeed" style="display: none;">
                </div>

                <!-- Media Grid -->
                <div class="media-grid" id="mediaGrid" style="display: none;">
                </div>

                <!-- Empty tab state -->
                <div class="empty-state" id="emptyTabState" style="display: none;">
                    <p id="emptyTabText"></p>
                </div>
            </div>
        </main>

        <!-- FAB -->
        <button class="fab" id="fab">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        </button>
    </div>

    <!-- Create Post Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-content create-post-modal" id="createPostForm">
                <div class="create-post-header">
                    <button class="create-post-close" id="createPostClose">Cancel</button>
                    <h2>New thread</h2>
                    <div class="create-post-header-icons">
                        <button class="header-icon-btn" id="draftsBtn" title="Drafts">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <rect height="15" rx="4.5" stroke="currentColor" stroke-width="2" width="15" x="7" y="7" fill="none"></rect>
                                <path clip-rule="evenodd" d="M15.3833 4.50007C15.0018 4.15977 14.5475 3.9045 14.05 3.75672C13.7983 3.68195 13.432 3.6357 12.7078 3.68313C11.9633 3.73189 11.0102 3.86454 9.59538 4.06338C8.18054 4.26222 7.22784 4.39741 6.4987 4.55577C5.78946 4.7098 5.45011 4.85522 5.22879 4.99646C4.51904 5.44941 3.99637 6.14302 3.7566 6.95012C3.68183 7.2018 3.63558 7.56809 3.68301 8.29232C3.73177 9.03686 3.86442 9.98992 4.06326 11.4047C4.23845 12.6513 4.36423 13.5391 4.49997 14.2313V17.5001C4.49997 17.737 4.51175 17.9713 4.53475 18.2022C4.05772 17.8249 3.64282 17.3681 3.31041 16.8473C2.66675 15.8387 2.47208 14.4535 2.08272 11.6831C1.69337 8.91269 1.49869 7.52748 1.83941 6.38057C2.21619 5.11227 3.03754 4.02231 4.15285 3.31053C5.16142 2.66688 6.54662 2.4722 9.31703 2.08284C12.0874 1.69349 13.4726 1.49881 14.6196 1.83953C15.8878 2.21631 16.9778 3.03766 17.6896 4.15297C17.7623 4.26696 17.8294 4.38577 17.8916 4.51084C17.7619 4.50369 17.6314 4.50007 17.5 4.50007H15.3833Z" fill-rule="evenodd"></path>
                                <rect height="2" rx="1" width="9" x="10" y="12"></rect>
                                <rect height="2" rx="1" width="6" x="10" y="15"></rect>
                            </svg>
                        </button>
                        <div class="more-menu-container">
                            <button class="header-icon-btn" id="moreMenuBtn" title="More">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                    <path d="M7.5 13.5C6.67157 13.5 6 12.8284 6 12C6 11.1716 6.67157 10.5 7.5 10.5C8.32843 10.5 9 11.1716 9 12C9 12.8284 8.32843 13.5 7.5 13.5Z"/>
                                    <path d="M12 13.5C11.1716 13.5 10.5 12.8284 10.5 12C10.5 11.1716 11.1716 10.5 12 10.5C12.8284 10.5 13.5 11.1716 13.5 12C13.5 12.8284 12.8284 13.5 12 13.5Z"/>
                                    <path d="M16.5 13.5C15.6716 13.5 15 12.8284 15 12C15 11.1716 15.6716 10.5 16.5 10.5C17.3284 10.5 18 11.1716 18 12C18 12.8284 17.3284 13.5 16.5 13.5Z"/>
                                </svg>
                            </button>
                            <div class="more-menu-dropdown" id="moreMenuDropdown">
                                <button class="more-menu-item">Add AI label</button>
                                <button class="more-menu-item">Mark as paid partnership</button>
                                <div class="more-menu-divider"></div>
                                <button class="more-menu-item">
                                    <span>Schedule...</span>
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="create-post-body">
                    <div class="create-post-user">
                        <img src="" alt="avatar" class="create-post-avatar" id="createPostAvatar">
                        <div class="create-post-line"></div>
                    </div>
                    <div class="create-post-content">
                        <div class="create-post-user-row">
                            <span class="create-post-username" id="createPostUsername"></span>
                            <button class="add-topic-btn">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <polyline points="9 18 15 12 9 6"/>
                                </svg>
                                Add a topic
                            </button>
                        </div>
                        <textarea class="create-post-textarea" id="createPostText" placeholder="What's new?" maxlength="2200"></textarea>
                        <div class="create-post-image-preview" id="createPostImagePreview" style="display: none;">
                        </div>
                        <div class="create-post-actions">
                            <label class="action-icon-btn" title="Add image">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <polyline points="21 15 16 10 5 21"/>
                                </svg>
                                <input type="file" accept="image/*" id="createPostImage" style="display: none;" multiple>
                            </label>
                            <button class="action-icon-btn" title="Add GIF">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="4" width="20" height="16" rx="2"/>
                                    <text x="6" y="15" font-size="8" fill="currentColor" stroke="none" font-weight="bold">GIF</text>
                                </svg>
                            </button>
                            <button class="action-icon-btn" title="Emoji">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                                    <line x1="9" y1="9" x2="9.01" y2="9"/>
                                    <line x1="15" y1="9" x2="15.01" y2="9"/>
                                </svg>
                            </button>
                            <button class="action-icon-btn" title="Add hashtag">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="4" y1="9" x2="20" y2="9"/>
                                    <line x1="4" y1="15" x2="20" y2="15"/>
                                    <line x1="10" y1="3" x2="8" y2="21"/>
                                    <line x1="16" y1="3" x2="14" y2="21"/>
                                </svg>
                            </button>
                            <button class="action-icon-btn" title="Add poll">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    <line x1="7" y1="8" x2="17" y2="8"/>
                                    <line x1="7" y1="12" x2="14" y2="12"/>
                                    <line x1="7" y1="16" x2="11" y2="16"/>
                                </svg>
                            </button>
                            <button class="action-icon-btn" title="Add location">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="add-to-thread">
                    <img src="" alt="avatar" class="add-thread-avatar" id="createPostAvatarSmall">
                    <span class="add-thread-text">Add to thread</span>
                </div>
                <div class="create-post-footer">
                    <div class="reply-options-container">
                        <button class="reply-options-btn" id="replyOptionsBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M22.4551 20.7695C22.0058 21.6518 21.3052 22.3789 20.4443 22.8613L20.2695 22.9551C19.6773 23.2567 19.0373 23.3828 18.3086 23.4424C17.5914 23.501 16.7032 23.5 15.5996 23.5H8.40039C7.29681 23.5 6.40858 23.501 5.69141 23.4424C5.0536 23.3903 4.48344 23.2877 3.9541 23.0605L3.73047 22.9551C2.78971 22.4757 2.0243 21.7106 1.54492 20.7695L3.32715 19.8623C3.61471 20.4266 4.0735 20.8853 4.6377 21.1729L4.74121 21.2217C4.99243 21.3298 5.32513 21.406 5.85449 21.4492C6.4713 21.4996 7.26395 21.5 8.40039 21.5H15.5996C16.7361 21.5 17.5287 21.4996 18.1455 21.4492C18.7507 21.3998 19.0989 21.3071 19.3623 21.1729L19.5684 21.0576C20.0384 20.7694 20.4212 20.3562 20.6729 19.8623L22.4551 20.7695Z" fill="#999999"/>
                                <path d="M15.5996 1.5C16.7032 1.5 17.5914 1.49902 18.3086 1.55762C19.0373 1.61716 19.6773 1.74326 20.2695 2.04492L20.4443 2.13867C21.3052 2.62114 22.0057 3.34834 22.4551 4.23047L22.5605 4.4541C22.7877 4.98343 22.8903 5.55359 22.9424 6.19141C23.001 6.90856 23 7.7968 23 8.90039V16.0996C23 17.2032 23.001 18.0914 22.9424 18.8086C22.8828 19.5373 22.7568 20.1774 22.4551 20.7695L21.5645 20.3154L20.6729 19.8623C20.8069 19.5991 20.8998 19.2505 20.9492 18.6455C20.9996 18.0287 21 17.2361 21 16.0996V8.90039C21 7.76395 20.9996 6.97128 20.9492 6.35449C20.906 5.82503 20.8299 5.49237 20.7217 5.24121L20.6729 5.13867C20.4211 4.64473 20.0383 4.23057 19.5684 3.94238L19.3623 3.82715C19.099 3.69296 18.7507 3.60023 18.1455 3.55078C17.5287 3.5004 16.7361 3.5 15.5996 3.5H8.40039C7.26396 3.5 6.4713 3.5004 5.85449 3.55078C5.24933 3.60023 4.90109 3.69295 4.6377 3.82715L4.43164 3.94238C3.96163 4.2306 3.57876 4.6438 3.32715 5.1377L3.27832 5.24121C3.17014 5.49237 3.09405 5.82502 3.05078 6.35449C3.0004 6.97127 3 7.76394 3 8.90039V16.0996C3 17.2361 3.00041 18.0287 3.05078 18.6455C3.10021 19.2505 3.19307 19.5991 3.32715 19.8623L2.43555 20.3154L1.54492 20.7695C1.24321 20.1774 1.11716 19.5373 1.05762 18.8086C0.999026 18.0914 1 17.2032 1 16.0996V8.90039C1 7.79681 0.999022 6.90856 1.05762 6.19141C1.11716 5.46271 1.2432 4.82264 1.54492 4.23047L1.6377 4.05567C2.12007 3.19456 2.84778 2.4943 3.72949 2.04492C4.32169 1.74327 4.96271 1.61716 5.69141 1.55762C6.40858 1.49902 7.29682 1.5 8.40039 1.5H15.5996Z" fill="#999999"/>
                                <path d="M8.00586 6.50586C8.55812 6.50589 9.00586 6.9536 9.00586 7.50586V13.5H10C10.5523 13.5 11 13.9477 11 14.5C11 15.0523 10.5523 15.5 10 15.5H9.00586V17.5059C9.00579 18.0581 8.55808 18.5058 8.00586 18.5059C7.45362 18.5059 7.00593 18.0581 7.00586 17.5059V15.5H6C5.44778 15.4999 5 15.0522 5 14.5C5 13.9478 5.44778 13.5001 6 13.5H7.00586V7.50586C7.00586 6.95358 7.45358 6.50586 8.00586 6.50586Z" fill="#999999"/>
                                <path d="M16.0059 6.50586C16.5581 6.50589 17.0059 6.9536 17.0059 7.50586V9.5H18C18.5523 9.5 19 9.94772 19 10.5C19 11.0523 18.5523 11.5 18 11.5H17.0059V17.5059C17.0058 18.0581 16.5581 18.5058 16.0059 18.5059C15.4536 18.5059 15.0059 18.0581 15.0059 17.5059V11.5H14C13.4478 11.4999 13 11.0522 13 10.5C13 9.94776 13.4478 9.50007 14 9.5H15.0059V7.50586C15.0059 6.95358 15.4536 6.50586 16.0059 6.50586Z" fill="#999999"/>
                            </svg>
                            <span>Reply options</span>
                        </button>
                    </div>
                    <button type="button" class="post-btn" id="postBtn" disabled>Post</button>
                </div>
            </div>
            <!-- Drafts view (inside same modal) -->
            <div class="drafts-view" id="draftsView" style="display: none;">
                <div class="drafts-header">
                    <button class="drafts-back-btn" id="draftsBackBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5"/>
                            <polyline points="12 19 5 12 12 5"/>
                        </svg>
                    </button>
                    <h2>Drafts</h2>
                    <div class="drafts-header-spacer"></div>
                </div>
                <div class="drafts-content">
                    <div class="drafts-empty">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor" class="drafts-empty-icon">
                            <rect height="15" rx="4.5" stroke="currentColor" stroke-width="1.5" width="15" x="7" y="7" fill="none"/>
                            <path clip-rule="evenodd" d="M15.3833 4.50007C15.0018 4.15977 14.5475 3.9045 14.05 3.75672C13.7983 3.68195 13.432 3.6357 12.7078 3.68313C11.9633 3.73189 11.0102 3.86454 9.59538 4.06338C8.18054 4.26222 7.22784 4.39741 6.4987 4.55577C5.78946 4.7098 5.45011 4.85522 5.22879 4.99646C4.51904 5.44941 3.99637 6.14302 3.7566 6.95012C3.68183 7.2018 3.63558 7.56809 3.68301 8.29232C3.73177 9.03686 3.86442 9.98992 4.06326 11.4047C4.23845 12.6513 4.36423 13.5391 4.49997 14.2313V17.5001C4.49997 17.737 4.51175 17.9713 4.53475 18.2022C4.05772 17.8249 3.64282 17.3681 3.31041 16.8473C2.66675 15.8387 2.47208 14.4535 2.08272 11.6831C1.69337 8.91269 1.49869 7.52748 1.83941 6.38057C2.21619 5.11227 3.03754 4.02231 4.15285 3.31053C5.16142 2.66688 6.54662 2.4722 9.31703 2.08284C12.0874 1.69349 13.4726 1.49881 14.6196 1.83953C15.8878 2.21631 16.9778 3.03766 17.6896 4.15297C17.7623 4.26696 17.8294 4.38577 17.8916 4.51084C17.7619 4.50369 17.6314 4.50007 17.5 4.50007H15.3833Z" fill-rule="evenodd"/>
                            <rect height="2" rx="1" width="9" x="10" y="12"/>
                            <rect height="2" rx="1" width="6" x="10" y="15"/>
                        </svg>
                        <p class="drafts-empty-title">No drafts yet</p>
                        <p class="drafts-empty-text">Your drafts will appear here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="edit-profile-overlay" id="editProfileOverlay">
        <div class="edit-profile-modal">
            <div class="edit-profile-section">
                <div class="edit-profile-name-row">
                    <div>
                        <label class="edit-label">Name</label>
                        <div class="edit-name-value">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2z"/></svg>
                            <span id="editName"></span>
                        </div>
                    </div>
                    <img src="" alt="avatar" class="edit-profile-avatar" id="editAvatar">
                </div>
            </div>
            <div class="edit-divider"></div>

            <div class="edit-profile-section">
                <label class="edit-label">Bio</label>
                <textarea class="edit-bio-input" id="editBio" rows="3"></textarea>
            </div>
            <div class="edit-divider"></div>

            <div class="edit-profile-section">
                <label class="edit-label">Interests</label>
                <div class="edit-row-link" id="interestsBtn">
                    <span class="interests-display" id="interestsDisplay">Add interests</span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="8 4 16 12 8 20"/></svg>
                </div>
            </div>
            <div class="edit-divider"></div>

            <div class="edit-profile-section">
                <div class="edit-row-link" id="linksBtn">
                    <span class="edit-label" style="margin-bottom:0">Links</span>
                    <div class="edit-row-right">
                        <span class="links-display" id="linksDisplay"></span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="8 4 16 12 8 20"/></svg>
                    </div>
                </div>
            </div>
            <div class="edit-divider"></div>

            <div class="edit-profile-section">
                <div class="edit-row-link" id="podcastBtn">
                    <span class="edit-label" style="margin-bottom:0">Podcast</span>
                    <div class="edit-row-right">
                        <span class="podcast-display" id="podcastDisplay"></span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="8 4 16 12 8 20"/></svg>
                    </div>
                </div>
            </div>
            <div class="edit-divider"></div>

            <div class="edit-profile-section">
                <div class="edit-row-link">
                    <label class="edit-label" style="margin-bottom:0">Show Instagram badge</label>
                    <div class="toggle-switch" id="igBadgeToggle">
                        <div class="toggle-knob"></div>
                    </div>
                </div>
            </div>
            <div class="edit-divider"></div>

            <div class="edit-profile-section">
                <div class="edit-row-link">
                    <div>
                        <label class="edit-label" style="margin-bottom:0">Profile privacy</label>
                        <p class="edit-hint">If you switch to private, only followers can see your threads. Your replies will be visible to followers and individual profiles you reply to.</p>
                    </div>
                    <div class="edit-row-right">
                        <span class="edit-privacy-value">Public</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="8 4 16 12 8 20"/></svg>
                    </div>
                </div>
            </div>

            <div class="edit-profile-footer">
                <button class="edit-done-btn" id="editDoneBtn">Done</button>
            </div>

            <!-- Links Modal (inside edit profile) -->
            <div class="links-modal-overlay" id="linksModalOverlay">
                <div class="links-modal">
                    <!-- View 1: Links List -->
                    <div class="links-list-view" id="linksListView">
                        <div class="links-modal-header">
                            <button class="links-back-btn" id="linksBackBtn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 12H5"/>
                                    <polyline points="12 19 5 12 12 5"/>
                                </svg>
                            </button>
                            <span class="links-modal-title">Links</span>
                            <div class="links-header-spacer"></div>
                        </div>
                        <div class="links-modal-content">
                            <div class="links-selected-list" id="linksSelectedList"></div>
                            <button class="links-add-row" id="linksAddRowBtn">
                                <svg class="links-add-row-icon" width="20" height="20" viewBox="2 2 16 16" fill="none" stroke="currentColor">
                                    <path d="M8.39992 5.44993L9.50669 4.34316C11.2046 2.64524 13.9575 2.64524 15.6554 4.34316V4.34316V4.34316C17.3533 6.04108 17.3533 8.79396 15.6554 10.4919L14.5486 11.5987" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"/>
                                    <path d="M5.44773 8.40114L4.34096 9.50791C2.64304 11.2058 2.64304 13.9587 4.34096 15.6566V15.6566V15.6566C6.03889 17.3546 8.79176 17.3546 10.4897 15.6566L11.5965 14.5499" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"/>
                                    <path d="M12.7051 7.29565L7.2942 12.7065" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"/>
                                </svg>
                                <span class="links-add-row-text">Add Link</span>
                            </button>
                        </div>
                    </div>

                    <!-- View 2: Add Link Form -->
                    <div class="links-add-view" id="linksAddView">
                        <div class="links-modal-header">
                            <button class="links-back-btn" id="linksAddBackBtn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 12H5"/>
                                    <polyline points="12 19 5 12 12 5"/>
                                </svg>
                            </button>
                            <span class="links-modal-title">Add Link</span>
                            <button class="links-done-btn" id="linksDoneBtn">Done</button>
                        </div>
                        <div class="links-modal-content">
                            <div class="links-add-form">
                                <div class="links-add-form-field" id="linksUrlField">
                                    <input type="text" class="links-add-form-input" id="linksUrlInput" placeholder="URL">
                                </div>
                                <div class="links-add-form-field" id="linksTitleField">
                                    <input type="text" class="links-add-form-input" id="linksTitleInput" placeholder="Title (optional)">
                                </div>
                            </div>
                            <p class="links-error" id="linksError">Invalid link</p>
                            <p class="links-hint">You can also add two-way links to your profile. <strong>Learn more</strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Podcast Modal (inside edit profile) -->
            <div class="podcast-modal-overlay" id="podcastModalOverlay">
                <div class="podcast-modal">
                    <div class="podcast-modal-header">
                        <button class="podcast-back-btn" id="podcastBackBtn">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 12H5"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                        </button>
                        <span class="podcast-modal-title">Add podcast</span>
                        <button class="podcast-done-btn" id="podcastDoneBtn">Done</button>
                    </div>
                    <div class="podcast-modal-content">
                        <p class="podcast-description">Add a link to your Spotify, Apple or iHeart podcast</p>
                        <div class="podcast-form">
                            <div class="podcast-form-field" id="podcastUrlField">
                                <input type="text" class="podcast-form-input" id="podcastUrlInput" placeholder="URL">
                            </div>
                        </div>
                        <p class="podcast-error" id="podcastError">Invalid link</p>
                        <p class="podcast-hint">Your podcast link is public.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interests Modal -->
    <div class="interests-modal-overlay" id="interestsModalOverlay">
        <div class="interests-modal">
            <div class="interests-modal-header">
                <button class="interests-back-btn" id="interestsBackBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5"/>
                        <polyline points="12 19 5 12 12 5"/>
                    </svg>
                </button>
                <span class="interests-modal-title">Edit</span>
                <div class="interests-header-spacer"></div>
            </div>
            <div class="interests-modal-content">
                <div class="interests-input-container">
                    <input type="text" class="interests-input" placeholder="Add a topic" id="interestsInput" autocomplete="off">
                    <div class="interests-suggestions" id="interestsSuggestions"></div>
                </div>
                <div class="interests-selected-list" id="interestsSelectedList"></div>
                <p class="interests-hint">Your communities and interests are public.</p>
            </div>
        </div>
    </div>

    <!-- Post Toast -->
    <div class="post-toast" id="postToast">
        <div class="toast-content posting" id="toastPosting">
            <div class="toast-left">
                <div class="toast-spinner"></div>
                <span>Posting</span>
            </div>
        </div>
        <div class="toast-content posted" id="toastPosted" style="display: none;">
            <div class="toast-left">
                <svg class="toast-check" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
                <span>Posted</span>
            </div>
            <button class="toast-view-btn" id="toastViewBtn">View</button>
        </div>
    </div>

    <!-- Thread View Overlay -->
    <div class="thread-overlay" id="threadOverlay">
        <div class="thread-view">
            <div class="thread-header">
                <button class="thread-back-btn" id="threadBackBtn">
                    <img src="icons/arrow-left.svg" width="20" height="20" alt="Back">
                </button>
                <span class="thread-title">Thread</span>
                <a class="thread-logo" href="index.html">
                    <img src="icons/logo.svg" width="28" height="32" alt="Threads">
                </a>
                <button class="thread-more-btn" id="threadMoreBtn">
                    <img src="icons/more.svg" width="20" height="20" alt="More">
                </button>
                <button class="thread-menu-btn" id="threadMenuBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <rect rx="1.25" x="3" y="7" width="18" height="2.5"></rect>
                        <rect rx="1.25" x="10" y="15" width="11" height="2.5"></rect>
                    </svg>
                </button>
            </div>
            <div class="thread-content" id="threadContent">
            </div>
        </div>
    </div>

    <!-- Delete Post Confirmation Modal -->
    <div class="delete-post-overlay" id="deletePostOverlay">
        <div class="delete-post-modal">
            <div class="delete-post-modal-body">
                <h3 class="delete-post-modal-title">Delete post?</h3>
                <p class="delete-post-modal-text">If you delete this post, you won't be able to restore it.</p>
            </div>
            <div class="delete-post-modal-actions">
                <button class="delete-post-modal-btn cancel" id="deletePostCancel">Cancel</button>
                <button class="delete-post-modal-btn confirm" id="deletePostConfirm">Delete</button>
            </div>
        </div>
    </div>

    <script src="security.js"></script>
    <script>
        // load saved theme
        let raw = localStorage.getItem('threads_theme');
        let savedTheme = 'auto';
        if (raw) {
            savedTheme = JSON.parse(raw);
        }
        if (savedTheme == 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else if (savedTheme == 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        } else {
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        }

        // Sync active class on appearance buttons to match current theme
        let allAppearanceBtns = document.querySelectorAll('.appearance-option');
        for (let i = 0; i < allAppearanceBtns.length; i++) {
            if (allAppearanceBtns[i].getAttribute('data-theme') === savedTheme) {
                allAppearanceBtns[i].classList.add('active');
            } else {
                allAppearanceBtns[i].classList.remove('active');
            }
        }

        let currentUser = null;

        // get user posts from localstorage
        function getUserPosts() {
            // try to get data, ignore errors
            try {
                let data = localStorage.getItem('threads_user_posts');
                if (!data) {
                    return [];
                }
                let posts = JSON.parse(data);
                if (!posts) {
                    posts = [];
                }
                // assign IDs to any posts missing one
                let needsSave = false;
                let maxId = 3000;
                for (let i = 0; i < posts.length; i++) {
                    if (posts[i].id && posts[i].id >= maxId) {
                        maxId = posts[i].id + 1;
                    }
                }
                for (let i = 0; i < posts.length; i++) {
                    if (!posts[i].id) {
                        posts[i].id = maxId++;
                        needsSave = true;
                    }
                }
                if (needsSave) {
                    localStorage.setItem('threads_user_posts', JSON.stringify(posts));
                }
                return posts;
            } catch(e) {
                return [];
            }
        }

        // sample posts for profile
        function getSamplePosts() {
            return [
                { text: 'U glow differently when your confidence is fueled by belief in yourself instead of validation from others.', time: '01/02/2026', image: 'images/post1.jpg' },
                { text: 'Morning climb session was absolutely insane today. New personal best on the 7b route', time: '30/01/2026', image: 'images/post2.jpg' },
                { text: 'Reminder: you don\'t need to explain yourself to anyone. Your journey is yours.', time: '28/01/2026', image: 'images/post3.jpg' },
                { text: 'Golden hour at the crag hits different. The rock, the light, the silence. Pure therapy.', time: '25/01/2026', image: 'images/post4.jpg' },
                { text: 'Just finished reading "The Rock Warrior\'s Way" and it completely changed how I think about fear on the wall. Highly recommend for any climbers out there.', time: '22/01/2026', image: 'images/post1.jpg' },
                { text: 'Rest day means meal prep day. Fueling the body right is half the battle.', time: '19/01/2026', image: 'images/post2.jpg' },
                { text: 'Sometimes the hardest part isn\'t the climb. It\'s showing up when you don\'t feel like it.', time: '16/01/2026', image: 'images/post3.jpg' },
                { text: 'New climbing shoes arrived and I\'m unreasonably excited about this. The grip on these is next level.', time: '12/01/2026', image: 'images/post4.jpg' },
                { text: 'Spent the weekend bouldering with friends. Nothing beats good company and good problems to solve.', time: '08/01/2026', image: 'images/post1.jpg' },
                { text: 'Your only competition is who you were yesterday. Keep pushing.', time: '03/01/2026', image: 'images/post2.jpg' },
                { text: 'Sunset from the top of the route today. Earned every inch of that view.', time: '28/12/2025', image: 'images/post3.jpg' },
                { text: 'Recovery days are just as important as send days. Listen to your body.', time: '22/12/2025', image: 'images/post4.jpg' },
                { text: 'Started training finger strength on the hangboard. The gains are slow but the progress is real.', time: '15/12/2025', image: 'images/post1.jpg' },
                { text: 'Life update: signed up for my first outdoor climbing competition next month. Nervous and excited!', time: '10/12/2025', image: 'images/post2.jpg' },
                { text: 'The way the morning fog rolls through the valley before a climb... nature really is the best artist.', time: '06/12/2025', image: 'images/post3.jpg' },
                { text: 'Grateful for the climbing community. You push me to be better every single day.', time: '01/12/2025', image: 'images/post4.jpg' }
            ];
        }

        // render posts
        function renderPosts() {
            let feed = document.getElementById('profileFeed');
            if (!feed || !currentUser) return;

            let posts = getUserPosts();
            feed.innerHTML = '';

            if (posts.length == 0) {
                let emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty-state';
                let emptyP = document.createElement('p');
                emptyP.textContent = 'No threads yet';
                emptyDiv.appendChild(emptyP);
                feed.appendChild(emptyDiv);
                return;
            }

            for (let i = 0; i < posts.length; i++) {
                let post = posts[i];
                let div = document.createElement('div');
                div.className = 'profile-post';
                if (post.id) div.setAttribute('data-id', post.id);

                // avatar
                let avatarImg = document.createElement('img');
                avatarImg.className = 'profile-post-avatar';
                avatarImg.alt = sanitize(currentUser.username);
                avatarImg.src = currentUser.avatar || '';
                div.appendChild(avatarImg);

                // content
                let contentDiv = document.createElement('div');
                contentDiv.className = 'profile-post-content';

                // header row
                let headerDiv = document.createElement('div');
                headerDiv.className = 'profile-post-header';

                let usernameSpan = document.createElement('span');
                usernameSpan.className = 'profile-post-username';
                usernameSpan.textContent = currentUser.username;
                headerDiv.appendChild(usernameSpan);

                let timeSpan = document.createElement('span');
                timeSpan.className = 'profile-post-time';
                if (post.time) {
                    timeSpan.textContent = post.time;
                } else {
                    timeSpan.textContent = '';
                }
                headerDiv.appendChild(timeSpan);

                let menuContainer = document.createElement('div');
                menuContainer.className = 'profile-post-menu';

                let menuBtn = document.createElement('button');
                menuBtn.className = 'post-menu-btn';
                menuBtn.innerHTML = '<svg aria-label="More" role="img" viewBox="0 0 24 24" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title>More</title><circle cx="12" cy="12" r="1.5"></circle><circle cx="6" cy="12" r="1.5"></circle><circle cx="18" cy="12" r="1.5"></circle></svg>';
                menuContainer.appendChild(menuBtn);

                let menuDropdown = document.createElement('div');
                menuDropdown.className = 'post-menu-dropdown';
                menuDropdown.innerHTML = '<button class="post-menu-item"><span>Insights</span><svg aria-label="" role="img" viewBox="0 0 24 24" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title></title><rect fill="none" height="20" rx="5" stroke="currentColor" stroke-width="2" width="20" x="2" y="2"></rect><rect height="12" rx="1" width="2" x="11" y="6" fill="currentColor"></rect><rect height="9" rx="1" width="2" x="15" y="9" fill="currentColor"></rect><rect height="5" rx="1" width="2" x="7" y="13" fill="currentColor"></rect></svg></button><button class="post-menu-item"><span>Save</span><svg aria-label="" role="img" viewBox="0 0 24 24" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title></title><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z" fill="none" stroke="currentColor" stroke-width="2"></path></svg></button><button class="post-menu-item"><span>Pin to profile</span><svg aria-label="" role="img" viewBox="0 0 20 20" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title></title><path d="M11.5789 11.8456L14.565 8.09342L18.3334 8.62727C18.5236 8.65422 18.6387 8.42365 18.5029 8.28783L11.6895 1.47438C11.5536 1.33856 11.3231 1.45367 11.35 1.64386L11.8839 5.4123L8.13171 8.39844M11.5789 11.8456C12.3679 12.8543 13.4711 14.8343 11.8872 17.1319C11.4954 17.7003 10.6866 17.6916 10.1984 17.2035L6.48613 13.4912M11.5789 11.8456V11.8456C10.6897 10.4631 9.51421 9.28756 8.13171 8.39844V8.39844M8.13171 8.39844C7.40288 7.95584 6.24522 7.39628 4.93842 7.45125C4.27222 7.47928 3.56725 7.66702 2.86059 8.1114C2.27618 8.4789 2.28566 9.29071 2.77382 9.77886L6.48613 13.4912M6.48613 13.4912L2.36827 17.609" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path></svg></button><button class="post-menu-item"><span>Hide like and share co...</span><svg aria-label="" role="img" viewBox="0 0 20 20" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title></title><path d="M2.14555 5.86847C2.25874 5.47003 2.0275 5.05526 1.62905 4.94207C1.2306 4.82888 0.815836 5.06012 0.702645 5.45857C0.536571 6.04318 0.449219 6.66962 0.449219 7.3272C0.449219 9.37797 1.32346 11.3552 2.78088 13.1862C4.23798 15.0167 6.3081 16.7411 8.78837 18.3088L8.80249 18.3175C8.95243 18.4077 9.13262 18.5076 9.31738 18.5872C9.48405 18.6589 9.73381 18.7498 9.99941 18.7498C10.2664 18.7498 10.5162 18.6611 10.688 18.5872C10.8756 18.5064 11.0561 18.4048 11.2057 18.3118L11.2057 18.3118L11.2104 18.3088C11.853 17.9026 12.4672 17.4865 13.0497 17.0614C13.3843 16.8172 13.4576 16.348 13.2134 16.0134C12.9692 15.6788 12.5 15.6056 12.1654 15.8498C11.6125 16.2533 11.027 16.6502 10.4114 17.0393C10.3004 17.1082 10.1899 17.1685 10.095 17.2093C10.0554 17.2264 10.0245 17.2374 10.0021 17.2442C9.98008 17.2373 9.94956 17.2262 9.91033 17.2093C9.8138 17.1678 9.7003 17.1068 9.58259 17.0363C7.1956 15.5267 5.27334 13.9089 3.95448 12.252C2.63461 10.5938 1.94922 8.93659 1.94922 7.3272C1.94922 6.80283 2.01881 6.31464 2.14555 5.86847Z" fill="currentColor" fill-rule="evenodd"></path><path d="M13.7373 1.24951C12.2124 1.24951 10.9274 1.81108 10.0015 2.71991C9.10085 1.83343 7.8445 1.27362 6.35846 1.25027C5.9443 1.24377 5.60328 1.57424 5.59677 1.9884C5.59027 2.40256 5.92074 2.74358 6.3349 2.75009C7.71763 2.77181 8.76569 3.40626 9.38048 4.3045C9.51976 4.50801 9.75018 4.63004 9.99679 4.63089C10.2434 4.63175 10.4747 4.51132 10.6154 4.30879C11.2594 3.38168 12.3276 2.74951 13.7373 2.74951C16.1572 2.74951 18.0496 4.57883 18.0496 7.32726C18.0496 8.78818 17.4853 10.2877 16.3931 11.7936C16.1499 12.1289 16.2245 12.5978 16.5598 12.841C16.8951 13.0842 17.3641 13.0096 17.6073 12.6743C18.8291 10.9898 19.5496 9.18843 19.5496 7.32726C19.5496 3.79869 17.0331 1.24951 13.7373 1.24951Z" fill="currentColor" fill-rule="evenodd"></path><path d="M1.5 1.5L18.5 18" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"></path></svg></button><button class="post-menu-item"><span>Reply options</span><svg aria-label="" role="img" viewBox="0 0 24 24" style="--x-fill: currentColor; --x-height: 16px; --x-width: 16px; transform: rotate(180deg);"><title></title><polyline points="16.502 3 7.498 12 16.502 21" fill="none" stroke="currentColor" stroke-width="2"></polyline></svg></button><button class="post-menu-item delete"><span>Delete</span><svg aria-label="" role="img" viewBox="0 0 20 20" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title></title><path d="M6.75 3.5V2.5C6.75 1.67157 7.42157 1 8.25 1H11.75C12.5784 1 13.25 1.67157 13.25 2.5V3.5" fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"></path><path d="M3.75 4L4.54449 15.5202C4.61689 16.57 4.6531 17.0949 4.88062 17.4928C5.08095 17.8431 5.38256 18.1246 5.74584 18.3004C6.15846 18.5 6.68461 18.5 7.73691 18.5H12.2631C13.3154 18.5 13.8415 18.5 14.2542 18.3004C14.6174 18.1246 14.9191 17.8431 15.1194 17.4928C15.3469 17.0949 15.3831 16.57 15.4555 15.5202L16.25 4M3.75 4H16.25M3.75 4H1.75M16.25 4H18.25" fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"></path></svg></button><button class="post-menu-item"><span>Copy link</span><svg aria-label="" role="img" viewBox="2 2 16 16" style="--x-fill: transparent; --x-height: 20px; --x-width: 20px;"><title></title><path d="M8.39992 5.44993L9.50669 4.34316C11.2046 2.64524 13.9575 2.64524 15.6554 4.34316V4.34316V4.34316C17.3533 6.04108 17.3533 8.79396 15.6554 10.4919L14.5486 11.5987" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"></path><path d="M5.44773 8.40114L4.34096 9.50791C2.64304 11.2058 2.64304 13.9587 4.34096 15.6566V15.6566V15.6566C6.03889 17.3546 8.79176 17.3546 10.4897 15.6566L11.5965 14.5499" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"></path><path d="M12.7051 7.29565L7.2942 12.7065" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"></path></svg></button>';
                menuContainer.appendChild(menuDropdown);

                menuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    let allDropdowns = document.querySelectorAll('.post-menu-dropdown.active');
                    for (let d = 0; d < allDropdowns.length; d++) {
                        if (allDropdowns[d] !== menuDropdown) {
                            allDropdowns[d].classList.remove('active');
                        }
                    }
                    menuDropdown.classList.toggle('active');
                });

                // set post id on delete button for event delegation
                let delBtn = menuDropdown.querySelector('.post-menu-item.delete');
                if (delBtn) {
                    delBtn.setAttribute('data-delete-post-id', post.id);
                }

                headerDiv.appendChild(menuContainer);

                contentDiv.appendChild(headerDiv);

                // post text
                let textP = document.createElement('p');
                textP.className = 'profile-post-text';
                if (post.text) {
                    textP.textContent = post.text;
                } else {
                    textP.textContent = '';
                }
                contentDiv.appendChild(textP);

                // post images (support both images array and single image)
                if (post.images && post.images.length > 0) {
                    for (let im = 0; im < post.images.length; im++) {
                        let postImg = document.createElement('img');
                        postImg.className = 'profile-post-image';
                        postImg.src = post.images[im];
                        postImg.alt = '';
                        postImg.loading = 'lazy';
                        contentDiv.appendChild(postImg);
                    }
                } else if (post.image && typeof post.image == 'string' && post.image.length > 0) {
                    let postImg = document.createElement('img');
                    postImg.className = 'profile-post-image';
                    postImg.src = post.image;
                    postImg.alt = '';
                    postImg.loading = 'lazy';
                    contentDiv.appendChild(postImg);
                }

                // action buttons
                let actionsDiv = document.createElement('div');
                actionsDiv.className = 'profile-post-actions';
                actionsDiv.innerHTML = '<button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button><button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></button><button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg></button><button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg></button>';
                contentDiv.appendChild(actionsDiv);

                // engagement stats
                let statsDiv = document.createElement('div');
                statsDiv.className = 'profile-post-stats';
                let likes = post.likes;
                if (!likes) {
                    likes = 0;
                }
                let comments = post.comments;
                if (!comments) {
                    comments = 0;
                }
                let statsText = [];
                if (likes > 0) {
                    let likeWord = '';
                    if (likes != 1) {
                        likeWord = 's';
                    }
                    statsText.push(likes + ' like' + likeWord);
                }
                if (comments > 0) {
                    let replyWord = '';
                    if (comments != 1) {
                        replyWord = 'ies';
                    } else {
                        replyWord = 'y';
                    }
                    statsText.push(comments + ' repl' + replyWord);
                }
                let statsString = '';
                for (let s = 0; s < statsText.length; s++) {
                    if (s > 0) {
                        statsString = statsString + ' - ';
                    }
                    statsString = statsString + statsText[s];
                }
                statsDiv.textContent = statsString;
                contentDiv.appendChild(statsDiv);

                div.appendChild(contentDiv);
                feed.appendChild(div);
            }
        }

        // render media feed (posts with images only, card layout without text)
        function renderMedia() {
            let feed = document.getElementById('profileFeed');
            if (!feed || !currentUser) return;

            let userPosts = getUserPosts();
            let mediaPosts = [];
            for (let i = 0; i < userPosts.length; i++) {
                let hasImage = false;
                if (userPosts[i].images && userPosts[i].images.length > 0) {
                    hasImage = true;
                } else if (userPosts[i].image) {
                    hasImage = true;
                }
                if (hasImage) {
                    mediaPosts.push(userPosts[i]);
                }
            }

            feed.innerHTML = '';

            if (mediaPosts.length == 0) {
                feed.style.display = 'none';
                let emptyState = document.getElementById('emptyTabState');
                let emptyText = document.getElementById('emptyTabText');
                if (emptyState && emptyText) {
                    emptyText.textContent = 'No media yet';
                    emptyState.style.display = '';
                }
                return;
            }

            for (let i = 0; i < mediaPosts.length; i++) {
                let post = mediaPosts[i];
                let div = document.createElement('div');
                div.className = 'profile-post';
                div.setAttribute('data-id', post.id);

                let avatarImg = document.createElement('img');
                avatarImg.className = 'profile-post-avatar';
                avatarImg.alt = currentUser.username;
                avatarImg.src = currentUser.avatar || '';
                div.appendChild(avatarImg);

                let contentDiv = document.createElement('div');
                contentDiv.className = 'profile-post-content';

                let headerDiv = document.createElement('div');
                headerDiv.className = 'profile-post-header';

                let usernameSpan = document.createElement('span');
                usernameSpan.className = 'profile-post-username';
                usernameSpan.textContent = currentUser.username;
                headerDiv.appendChild(usernameSpan);

                let timeSpan = document.createElement('span');
                timeSpan.className = 'profile-post-time';
                timeSpan.textContent = post.time || '';
                headerDiv.appendChild(timeSpan);

                let menuContainer = document.createElement('div');
                menuContainer.className = 'profile-post-menu';

                let menuBtn = document.createElement('button');
                menuBtn.className = 'post-menu-btn';
                menuBtn.innerHTML = '<svg aria-label="More" role="img" viewBox="0 0 24 24" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title>More</title><circle cx="12" cy="12" r="1.5"></circle><circle cx="6" cy="12" r="1.5"></circle><circle cx="18" cy="12" r="1.5"></circle></svg>';
                menuContainer.appendChild(menuBtn);

                let menuDropdown = document.createElement('div');
                menuDropdown.className = 'post-menu-dropdown';
                menuDropdown.innerHTML = '<button class="post-menu-item"><span>Insights</span></button><button class="post-menu-item"><span>Save</span></button><button class="post-menu-item"><span>Pin to profile</span></button><button class="post-menu-item delete"><span>Delete</span></button><button class="post-menu-item"><span>Copy link</span></button>';
                menuContainer.appendChild(menuDropdown);

                menuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    let allDropdowns = document.querySelectorAll('.post-menu-dropdown.active');
                    for (let d = 0; d < allDropdowns.length; d++) {
                        if (allDropdowns[d] !== menuDropdown) {
                            allDropdowns[d].classList.remove('active');
                        }
                    }
                    menuDropdown.classList.toggle('active');
                });

                // set post id on delete button for event delegation
                let delBtn = menuDropdown.querySelector('.post-menu-item.delete');
                if (delBtn) {
                    delBtn.setAttribute('data-delete-post-id', post.id);
                }

                headerDiv.appendChild(menuContainer);
                contentDiv.appendChild(headerDiv);

                // show images (support both images array and single image)
                if (post.images && post.images.length > 0) {
                    for (let im = 0; im < post.images.length; im++) {
                        let postImg = document.createElement('img');
                        postImg.className = 'profile-post-image';
                        postImg.src = post.images[im];
                        postImg.alt = '';
                        postImg.loading = 'lazy';
                        contentDiv.appendChild(postImg);
                    }
                } else if (post.image) {
                    let postImg = document.createElement('img');
                    postImg.className = 'profile-post-image';
                    postImg.src = post.image;
                    postImg.alt = '';
                    postImg.loading = 'lazy';
                    contentDiv.appendChild(postImg);
                }

                let actionsDiv = document.createElement('div');
                actionsDiv.className = 'profile-post-actions';
                actionsDiv.innerHTML = '<button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button><button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></button><button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg></button><button class="profile-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg></button>';
                contentDiv.appendChild(actionsDiv);

                let statsDiv = document.createElement('div');
                statsDiv.className = 'profile-post-stats';
                let likes = post.likes || 0;
                let comments = post.comments || 0;
                let statsText = [];
                if (likes > 0) {
                    statsText.push(likes + ' like' + (likes != 1 ? 's' : ''));
                }
                if (comments > 0) {
                    statsText.push(comments + (comments != 1 ? ' replies' : ' reply'));
                }
                statsDiv.textContent = statsText.join(' - ');
                contentDiv.appendChild(statsDiv);

                div.appendChild(contentDiv);
                feed.appendChild(div);
            }
        }

        // get relative time string
        function getRelativeTime(timestamp) {
            let now = Date.now();
            let diff = now - timestamp;
            let seconds = Math.floor(diff / 1000);
            let minutes = Math.floor(seconds / 60);
            let hours = Math.floor(minutes / 60);
            let days = Math.floor(hours / 24);
            if (days > 0) return days + 'd ago';
            if (hours > 0) return hours + 'h ago';
            if (minutes > 0) return minutes + 'm ago';
            return 'just now';
        }

        // render replies tab
        function renderReplies() {
            let repliesFeed = document.getElementById('repliesFeed');
            let emptyState = document.getElementById('emptyTabState');
            let emptyText = document.getElementById('emptyTabText');
            if (!repliesFeed) return;

            // load replies from localStorage
            let replies = [];
            try {
                let data = localStorage.getItem('threads_user_replies');
                if (data) {
                    replies = JSON.parse(data);
                }
            } catch(e) {}

            // sort newest first
            replies.sort(function(a, b) {
                return (b.repliedAt || 0) - (a.repliedAt || 0);
            });

            if (replies.length == 0) {
                repliesFeed.style.display = 'none';
                if (emptyState && emptyText) {
                    emptyText.textContent = 'No replies yet';
                    emptyState.style.display = '';
                }
                return;
            }

            repliesFeed.innerHTML = '';
            repliesFeed.style.display = '';
            if (emptyState) emptyState.style.display = 'none';

            for (let i = 0; i < replies.length; i++) {
                let entry = replies[i];
                let orig = entry.originalPost;
                if (!orig) continue;

                let threadDiv = document.createElement('div');
                threadDiv.className = 'reply-thread';

                // === Original post (top) ===
                let origSection = document.createElement('div');
                origSection.className = 'reply-thread-original';

                // avatar column with connecting line
                let avatarCol = document.createElement('div');
                avatarCol.className = 'reply-avatar-col';

                let origAvatar = document.createElement('img');
                origAvatar.className = 'reply-thread-avatar';
                origAvatar.src = orig.avatar || 'images/avatar1.jpg';
                origAvatar.alt = '';
                avatarCol.appendChild(origAvatar);

                let line = document.createElement('div');
                line.className = 'reply-thread-line';
                avatarCol.appendChild(line);

                origSection.appendChild(avatarCol);

                // original post content
                let origContent = document.createElement('div');
                origContent.className = 'reply-thread-content';

                // header
                let origHeader = document.createElement('div');
                origHeader.className = 'reply-thread-header';

                let origUsername = document.createElement('span');
                origUsername.className = 'reply-thread-username';
                origUsername.textContent = orig.username || 'user';
                origHeader.appendChild(origUsername);

                if (orig.verified) {
                    let verifiedSvg = document.createElement('span');
                    verifiedSvg.innerHTML = '<svg class="reply-thread-verified" viewBox="0 0 40 40" fill="none"><path d="M19.998 3.094L14.638 0l-2.972 5.15H5.432v6.354L0 14.64 3.094 20 0 25.359l5.432 3.137v6.354h6.234L14.638 40l5.36-3.094L25.358 40l2.972-5.15h6.234v-6.354L40 25.359 36.906 20 40 14.641l-5.436-3.137V5.15h-6.234L25.358 0l-5.36 3.094Z" fill="#0095F6"/><path d="m17.884 28.468-6.116-6.22 2.852-2.853 3.264 3.264 8.332-8.332 2.852 2.853-11.184 11.288Z" fill="#fff"/></svg>';
                    origHeader.appendChild(verifiedSvg);
                }

                let origTime = document.createElement('span');
                origTime.className = 'reply-thread-time';
                origTime.textContent = orig.time || '';
                origHeader.appendChild(origTime);

                origContent.appendChild(origHeader);

                // text
                if (orig.text) {
                    let origText = document.createElement('p');
                    origText.className = 'reply-thread-text';
                    origText.textContent = orig.text;
                    origContent.appendChild(origText);
                }

                // image
                if (orig.image && typeof orig.image == 'string' && orig.image.length > 0) {
                    let origImg = document.createElement('img');
                    origImg.className = 'reply-thread-image';
                    origImg.src = orig.image;
                    origImg.alt = '';
                    origImg.loading = 'lazy';
                    origContent.appendChild(origImg);
                }

                // action buttons with counts
                let origActions = document.createElement('div');
                origActions.className = 'reply-thread-actions';

                let likesCount = orig.likes > 0 ? '<span class="reply-thread-action-count">' + orig.likes + '</span>' : '';
                let repliesCount = orig.replies > 0 ? '<span class="reply-thread-action-count">' + orig.replies + '</span>' : '';
                let repostsCount = orig.reposts > 0 ? '<span class="reply-thread-action-count">' + orig.reposts + '</span>' : '';
                let sharesCount = orig.shares > 0 ? '<span class="reply-thread-action-count">' + orig.shares + '</span>' : '';

                origActions.innerHTML = '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>' + likesCount + '</button>'
                    + '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>' + repliesCount + '</button>'
                    + '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>' + repostsCount + '</button>'
                    + '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>' + sharesCount + '</button>';

                origContent.appendChild(origActions);
                origSection.appendChild(origContent);
                threadDiv.appendChild(origSection);

                // === User's reply (bottom) ===
                let replySection = document.createElement('div');
                replySection.className = 'reply-thread-reply';

                let replyAvatar = document.createElement('img');
                replyAvatar.className = 'reply-thread-avatar';
                replyAvatar.src = currentUser ? currentUser.avatar : 'images/avatar1.jpg';
                replyAvatar.alt = '';
                replySection.appendChild(replyAvatar);

                let replyContent = document.createElement('div');
                replyContent.className = 'reply-thread-content';

                // reply header
                let replyHeader = document.createElement('div');
                replyHeader.className = 'reply-thread-header';

                let replyUsername = document.createElement('span');
                replyUsername.className = 'reply-thread-username';
                replyUsername.textContent = entry.repliedBy || (currentUser ? currentUser.username : 'you');
                replyHeader.appendChild(replyUsername);

                let replyTime = document.createElement('span');
                replyTime.className = 'reply-thread-time';
                replyTime.textContent = getRelativeTime(entry.repliedAt);
                replyHeader.appendChild(replyTime);

                // three dots menu
                let replyMenu = document.createElement('div');
                replyMenu.className = 'reply-thread-menu';
                replyMenu.innerHTML = '<button class="post-menu-btn"><svg aria-label="More" role="img" viewBox="0 0 24 24" style="--x-fill: currentColor; --x-height: 20px; --x-width: 20px;"><title>More</title><circle cx="12" cy="12" r="1.5"></circle><circle cx="6" cy="12" r="1.5"></circle><circle cx="18" cy="12" r="1.5"></circle></svg></button>';
                replyHeader.appendChild(replyMenu);

                replyContent.appendChild(replyHeader);

                // reply text
                if (entry.userText) {
                    let replyText = document.createElement('p');
                    replyText.className = 'reply-thread-text';
                    replyText.textContent = entry.userText;
                    replyContent.appendChild(replyText);
                }

                // reply action buttons (no counts)
                let replyActions = document.createElement('div');
                replyActions.className = 'reply-thread-actions';
                replyActions.innerHTML = '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>'
                    + '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></button>'
                    + '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg></button>'
                    + '<button class="reply-thread-action-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg></button>';
                replyContent.appendChild(replyActions);

                replySection.appendChild(replyContent);
                threadDiv.appendChild(replySection);

                repliesFeed.appendChild(threadDiv);
            }
        }

        // render reposts tab
        function renderReposts() {
            let feed = document.getElementById('profileFeed');
            let emptyState = document.getElementById('emptyTabState');
            let emptyText = document.getElementById('emptyTabText');
            if (!feed) return;

            // load reposts from localStorage
            let reposts = [];
            try {
                let data = localStorage.getItem('threads_user_reposts');
                if (data) {
                    reposts = JSON.parse(data);
                }
            } catch(e) {}

            feed.innerHTML = '';

            if (reposts.length == 0) {
                feed.style.display = 'none';
                if (emptyState && emptyText) {
                    emptyText.textContent = 'No reposts yet';
                    emptyState.style.display = '';
                }
                return;
            }

            if (emptyState) emptyState.style.display = 'none';

            for (let i = 0; i < reposts.length; i++) {
                let post = reposts[i].originalPost;
                if (!post) continue;

                let div = document.createElement('div');
                div.className = 'profile-post';

                // avatar
                let avatarImg = document.createElement('img');
                avatarImg.className = 'profile-post-avatar';
                avatarImg.src = post.avatar || 'images/avatar1.jpg';
                avatarImg.alt = '';
                div.appendChild(avatarImg);

                // content
                let contentDiv = document.createElement('div');
                contentDiv.className = 'profile-post-content';

                // header
                let headerDiv = document.createElement('div');
                headerDiv.className = 'profile-post-header';

                let usernameSpan = document.createElement('span');
                usernameSpan.className = 'profile-post-username';
                usernameSpan.textContent = post.username || '';
                headerDiv.appendChild(usernameSpan);

                // verified badge
                if (post.verified) {
                    let badge = document.createElement('span');
                    badge.className = 'profile-verified-badge';
                    badge.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="#0095f6"><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"/></svg>';
                    headerDiv.appendChild(badge);
                }

                // repost icon
                let repostIcon = document.createElement('span');
                repostIcon.className = 'profile-repost-icon';
                repostIcon.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>';
                headerDiv.appendChild(repostIcon);

                let timeSpan = document.createElement('span');
                timeSpan.className = 'profile-post-time';
                timeSpan.textContent = post.time || '';
                headerDiv.appendChild(timeSpan);

                let menuContainer = document.createElement('div');
                menuContainer.className = 'profile-post-menu';
                let menuBtn = document.createElement('button');
                menuBtn.className = 'post-menu-btn';
                menuBtn.innerHTML = '<svg aria-label="More" viewBox="0 0 24 24" style="width:20px;height:20px;fill:currentColor"><circle cx="12" cy="12" r="1.5"></circle><circle cx="6" cy="12" r="1.5"></circle><circle cx="18" cy="12" r="1.5"></circle></svg>';
                menuContainer.appendChild(menuBtn);
                headerDiv.appendChild(menuContainer);

                contentDiv.appendChild(headerDiv);

                // text
                if (post.text && post.text.trim() != '') {
                    let textP = document.createElement('p');
                    textP.className = 'profile-post-text';
                    textP.textContent = post.text;
                    contentDiv.appendChild(textP);
                }

                // images
                if (post.images && post.images.length > 0) {
                    for (let im = 0; im < post.images.length; im++) {
                        let postImg = document.createElement('img');
                        postImg.className = 'profile-post-image';
                        postImg.src = post.images[im];
                        postImg.alt = '';
                        postImg.loading = 'lazy';
                        contentDiv.appendChild(postImg);
                    }
                } else if (post.image) {
                    let postImg = document.createElement('img');
                    postImg.className = 'profile-post-image';
                    postImg.src = post.image;
                    postImg.alt = '';
                    postImg.loading = 'lazy';
                    contentDiv.appendChild(postImg);
                }

                // quote
                if (post.quote) {
                    let quoteDiv = document.createElement('div');
                    quoteDiv.className = 'profile-repost-quote';
                    let quoteHeader = document.createElement('div');
                    quoteHeader.className = 'profile-repost-quote-header';
                    let quoteAvatar = document.createElement('img');
                    quoteAvatar.className = 'profile-repost-quote-avatar';
                    quoteAvatar.src = post.quote.avatar || 'images/avatar1.jpg';
                    quoteHeader.appendChild(quoteAvatar);
                    let quoteName = document.createElement('span');
                    quoteName.className = 'profile-repost-quote-name';
                    quoteName.textContent = post.quote.username || '';
                    quoteHeader.appendChild(quoteName);
                    quoteDiv.appendChild(quoteHeader);
                    let quoteText = document.createElement('p');
                    quoteText.className = 'profile-repost-quote-text';
                    quoteText.textContent = post.quote.text || '';
                    quoteDiv.appendChild(quoteText);
                    contentDiv.appendChild(quoteDiv);
                }

                // stats with icons
                let statsDiv = document.createElement('div');
                statsDiv.className = 'profile-repost-stats';

                let likes = post.likes || 0;
                let replies = post.replies || 0;
                let repostCount = post.reposts || 0;
                let shares = post.shares || 0;

                statsDiv.innerHTML = ''
                    + '<span class="repost-stat' + (post.liked ? ' liked' : '') + '"><svg width="16" height="16" viewBox="0 0 24 24" fill="' + (post.liked ? '#ff3040' : 'none') + '" stroke="' + (post.liked ? '#ff3040' : 'currentColor') + '" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg> ' + likes + '</span>'
                    + '<span class="repost-stat"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg> ' + replies + '</span>'
                    + '<span class="repost-stat"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg> ' + repostCount + '</span>'
                    + '<span class="repost-stat"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg> ' + shares + '</span>';

                contentDiv.appendChild(statsDiv);

                div.appendChild(contentDiv);
                feed.appendChild(div);
            }
        }

        // switch profile tab view
        let activeTab = 'threads';
        function switchTab(tab) {
            activeTab = tab;
            let feed = document.getElementById('profileFeed');
            let composer = document.getElementById('profileComposer');
            let grid = document.getElementById('mediaGrid');
            let repliesFeed = document.getElementById('repliesFeed');
            let emptyState = document.getElementById('emptyTabState');
            let emptyText = document.getElementById('emptyTabText');

            // hide all
            feed.style.display = 'none';
            grid.style.display = 'none';
            if (repliesFeed) repliesFeed.style.display = 'none';
            if (composer) composer.style.display = 'none';
            if (emptyState) emptyState.style.display = 'none';

            if (tab == 'threads') {
                feed.style.display = '';
                if (composer) composer.style.display = '';
                renderPosts();
            } else if (tab == 'media') {
                feed.style.display = '';
                renderMedia();
            } else if (tab == 'replies') {
                renderReplies();
            } else if (tab == 'reposts') {
                feed.style.display = '';
                renderReposts();
            }
        }

        // load user data
        // clean up big images from old posts so storage doesnt get full
        function cleanupOldPosts() {
            let raw = localStorage.getItem('threads_user_posts');
            if (raw == null) return;
            let posts = JSON.parse(raw);
            let changed = false;
            for (let i = 0; i < posts.length; i++) {
                if (posts[i].images && posts[i].images.length > 0) {
                    let cleaned = [];
                    for (let j = 0; j < posts[i].images.length; j++) {
                        if (posts[i].images[j] && posts[i].images[j].length > 200000) {
                            changed = true;
                        } else if (posts[i].images[j] && posts[i].images[j] != '') {
                            cleaned.push(posts[i].images[j]);
                        }
                    }
                    posts[i].images = cleaned;
                }
                if (posts[i].image && posts[i].image.length > 200000) {
                    posts[i].image = '';
                    changed = true;
                }
            }
            if (changed) {
                localStorage.setItem('threads_user_posts', JSON.stringify(posts));
            }
        }

        function init() {
            // clean up old oversized images from storage
            cleanupOldPosts();

            let isLoggedIn = localStorage.getItem('threads_is_logged_in') == 'true';
            let user = null;
            // try to get data, ignore errors
            try {
                user = JSON.parse(localStorage.getItem('threads_user'));
            } catch(e) {}

            if (!isLoggedIn || !user) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = user;

            // set profile info
            let profileDisplayName = user.name;
            if (!profileDisplayName) {
                profileDisplayName = user.username;
            }
            document.getElementById('profileName').textContent = profileDisplayName;
            document.getElementById('profileUsername').textContent = user.username;
            document.getElementById('profileAvatar').src = user.avatar;
            document.getElementById('composerAvatar').src = user.avatar;
            let savedBio = localStorage.getItem('threads_profile_bio');
            if (savedBio) {
                document.getElementById('profileBio').textContent = savedBio;
            } else {
                document.getElementById('profileBio').textContent = "U glow differently ,when your confidence is fueled by belief in yourself instead of validation from others. Sport : Queen of climbing";
            }

            // render posts
            renderPosts();
        }

        // navigation
        let navBtns = document.querySelectorAll('.nav-btn[data-tab]');
        for (let i = 0; i < navBtns.length; i++) {
            let btn = navBtns[i];
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                let tab = this.getAttribute('data-tab');
                if (tab == 'home') {
                    window.location.href = 'home.html';
                } else if (tab == 'search') {
                    window.location.href = 'home.html#search';
                } else if (tab == 'create') {
                    openModal();
                } else if (tab == 'activity') {
                    window.location.href = 'activity.html';
                } else if (tab == 'profile') {
                    window.scrollTo(0, 0);
                }
            });
        }

        // profile tabs
        let profileTabs = document.querySelectorAll('.profile-tab');
        for (let i = 0; i < profileTabs.length; i++) {
            let tab = profileTabs[i];
            tab.addEventListener('click', function() {
                let allTabs = document.querySelectorAll('.profile-tab');
                for (let j = 0; j < allTabs.length; j++) {
                    allTabs[j].classList.remove('active');
                }
                this.classList.add('active');
                switchTab(this.getAttribute('data-tab'));
            });
        }

        // composer - open create post modal
        let profileComposer = document.getElementById('profileComposer');
        if (profileComposer) {
            profileComposer.onclick = function() {
                openModal();
            };
            profileComposer.style.cursor = 'pointer';
        }

        // Create Post Modal
        let modalOverlay = document.getElementById('modalOverlay');
        let createPostClose = document.getElementById('createPostClose');
        let createPostText = document.getElementById('createPostText');
        let postBtn = document.getElementById('postBtn');
        let createPostAvatar = document.getElementById('createPostAvatar');
        let createPostAvatarSmall = document.getElementById('createPostAvatarSmall');
        let createPostUsername = document.getElementById('createPostUsername');

        function openModal() {
            if (modalOverlay && currentUser) {
                if (createPostAvatar) {
                    if (currentUser.avatar) {
                        createPostAvatar.src = currentUser.avatar;
                    } else {
                        createPostAvatar.src = '';
                    }
                }
                if (createPostAvatarSmall) {
                    if (currentUser.avatar) {
                        createPostAvatarSmall.src = currentUser.avatar;
                    } else {
                        createPostAvatarSmall.src = '';
                    }
                }
                if (createPostUsername) {
                    if (currentUser.username) {
                        createPostUsername.textContent = currentUser.username;
                    } else {
                        createPostUsername.textContent = '';
                    }
                }
                modalOverlay.classList.add('active');
            }
        }

        function closeModal() {
            if (modalOverlay) {
                modalOverlay.classList.remove('active');
                modalOverlay.classList.remove('from-fab');
                if (createPostText) createPostText.value = '';
                if (postBtn) postBtn.disabled = true;
            }
            // clear image preview
            let preview = document.getElementById('createPostImagePreview');
            if (preview) {
                preview.innerHTML = '';
                preview.style.display = 'none';
            }
            let fileInput = document.getElementById('createPostImage');
            if (fileInput) fileInput.value = '';
            let fab = document.getElementById('fab');
            if (fab) fab.style.display = '';
        }

        if (createPostClose) {
            createPostClose.onclick = closeModal;
        }

        if (modalOverlay) {
            modalOverlay.addEventListener('click', function(e) {
                if (e.target == modalOverlay) closeModal();
            });
        }

        // check if modal has text or images
        function checkPostBtn() {
            let hasText = createPostText && createPostText.value.trim().length > 0;
            let preview = document.getElementById('createPostImagePreview');
            let hasImages = preview && preview.querySelectorAll('.create-post-image-item').length > 0;
            if (postBtn) {
                if (hasText || hasImages) {
                    postBtn.disabled = false;
                } else {
                    postBtn.disabled = true;
                }
            }
        }

        if (createPostText) {
            createPostText.addEventListener('input', function() {
                checkPostBtn();
            });
        }

        // compress image using canvas
        function compressImage(dataUrl, callback) {
            let maxW = 800;
            let maxH = 800;
            let quality = 0.7;
            let tempImg = new Image();
            tempImg.onload = function() {
                let w = tempImg.width;
                let h = tempImg.height;
                if (w > maxW || h > maxH) {
                    let ratio = Math.min(maxW / w, maxH / h);
                    w = Math.round(w * ratio);
                    h = Math.round(h * ratio);
                }
                let canvas = document.createElement('canvas');
                canvas.width = w;
                canvas.height = h;
                let ctx = canvas.getContext('2d');
                ctx.drawImage(tempImg, 0, 0, w, h);
                let compressed = canvas.toDataURL('image/jpeg', quality);
                callback(compressed);
            };
            tempImg.onerror = function() {
                callback(dataUrl);
            };
            tempImg.src = dataUrl;
        }

        // image upload
        let createPostImage = document.getElementById('createPostImage');
        if (createPostImage) {
            createPostImage.onchange = function(e) {
                let files = e.target.files;
                if (!files || files.length == 0) return;
                let preview = document.getElementById('createPostImagePreview');
                if (!preview) return;
                preview.style.display = 'flex';

                for (let f = 0; f < files.length; f++) {
                    (function(file) {
                        let reader = new FileReader();
                        reader.onload = function(ev) {
                            compressImage(ev.target.result, function(compressedSrc) {
                                let item = document.createElement('div');
                                item.className = 'create-post-image-item';

                                let img = document.createElement('img');
                                img.src = compressedSrc;
                                img.alt = 'preview';
                                item.appendChild(img);

                                // remove button
                                let removeBtn = document.createElement('button');
                                removeBtn.className = 'remove-image-btn';
                                removeBtn.innerHTML = '&times;';
                                removeBtn.onclick = function() {
                                    item.remove();
                                    if (preview.children.length == 0) {
                                        preview.style.display = 'none';
                                    }
                                    checkPostBtn();
                                };
                                item.appendChild(removeBtn);
                                preview.appendChild(item);
                                checkPostBtn();
                            });
                        };
                        reader.readAsDataURL(file);
                    })(files[f]);
                }
                // reset so same file can be picked again
                createPostImage.value = '';
            };
        }

        // toast functions
        let postToastTimer = null;
        function showPostToast(state) {
            let toast = document.getElementById('postToast');
            let posting = document.getElementById('toastPosting');
            let posted = document.getElementById('toastPosted');
            if (toast == null) return;
            if (postToastTimer != null) {
                clearTimeout(postToastTimer);
                postToastTimer = null;
            }
            if (state == 'posting') {
                posting.style.display = 'flex';
                posted.style.display = 'none';
            } else {
                posting.style.display = 'none';
                posted.style.display = 'flex';
                postToastTimer = setTimeout(function() {
                    hidePostToast();
                    postToastTimer = null;
                }, 4000);
            }
            toast.classList.add('active');
        }

        function hidePostToast() {
            let toast = document.getElementById('postToast');
            if (toast != null) toast.classList.remove('active');
        }

        function doPost() {
            if (!currentUser) return;

            let text = '';
            if (createPostText) {
                text = createPostText.value.trim();
            }

            // get images from preview
            let images = [];
            let preview = document.getElementById('createPostImagePreview');
            if (preview) {
                let imgElements = preview.querySelectorAll('img');
                for (let i = 0; i < imgElements.length; i++) {
                    if (imgElements[i].src && imgElements[i].src.length > 0 && imgElements[i].alt == 'preview') {
                        images.push(imgElements[i].src);
                    }
                }
            }

            // need at least text or image
            if (text.length == 0 && images.length == 0) return;

            closeModal();
            showPostToast('posting');

            setTimeout(function() {
                try {
                    // get existing posts
                    let posts = getUserPosts();

                    // generate unique id
                    let maxId = 3000;
                    for (let i = 0; i < posts.length; i++) {
                        if (posts[i].id && posts[i].id >= maxId) {
                            maxId = posts[i].id + 1;
                        }
                    }

                    // make the new post object
                    let newPost = {
                        id: maxId,
                        username: currentUser.username,
                        avatar: currentUser.avatar,
                        text: text,
                        time: 'now',
                        likes: 0,
                        comments: 0
                    };

                    if (images.length > 0) {
                        newPost.images = images;
                    }

                    posts.unshift(newPost);
                    localStorage.setItem('threads_user_posts', JSON.stringify(posts));
                } catch(e) {
                    console.log('Post save error:', e);
                }

                showPostToast('posted');

                // switch to Threads tab and render
                activeTab = 'threads';
                let allTabs = document.querySelectorAll('.profile-tab');
                for (let t = 0; t < allTabs.length; t++) {
                    allTabs[t].classList.remove('active');
                    if (allTabs[t].getAttribute('data-tab') == 'threads') {
                        allTabs[t].classList.add('active');
                    }
                }
                switchTab('threads');
            }, 1200);
        }

        if (postBtn) {
            postBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                doPost();
            });
        }

        // View button  show all user posts in thread overlay
        let toastViewBtn = document.getElementById('toastViewBtn');
        let threadOverlay = document.getElementById('threadOverlay');
        let threadBackBtn = document.getElementById('threadBackBtn');
        let threadContent = document.getElementById('threadContent');

        if (toastViewBtn != null) {
            toastViewBtn.onclick = function() {
                if (threadOverlay == null || threadContent == null) return;

                let userPosts = getUserPosts();
                let allHtml = '';

                for (let p = 0; p < userPosts.length; p++) {
                    let post = userPosts[p];
                    let safeUsername = sanitize(currentUser.username || '');
                    let safeText = sanitize(post.text || '');
                    safeText = safeText.replace(/#(\w+)/g, '<span class="post-hashtag">#$1</span>');
                    safeText = safeText.replace(/@(\w+)/g, '<span class="post-mention">@$1</span>');
                    safeText = safeText.replace(/\n/g, '<br>');

                    let imageHtml = '';
                    if (post.images != null && post.images.length > 0) {
                        for (let im = 0; im < post.images.length; im++) {
                            if (post.images[im] && post.images[im] != '') {
                                imageHtml += '<img src="' + post.images[im] + '" alt="Post image" class="thread-post-image">';
                            }
                        }
                    } else if (post.image != null) {
                        imageHtml = '<img src="' + post.image + '" alt="Post image" class="thread-post-image">';
                    }

                    allHtml += '<div class="thread-post" data-id="' + post.id + '">';
                    allHtml += '<div class="thread-post-header">';
                    allHtml += '<img src="' + encodeURI(currentUser.avatar || 'images/avatar1.jpg') + '" class="thread-post-avatar" alt="">';
                    allHtml += '<span class="thread-post-username">' + safeUsername + '</span>';
                    allHtml += '<span class="thread-post-time">' + (post.time || '') + '</span>';
                    allHtml += '<div class="thread-post-more-container">';
                    allHtml += '<button class="thread-post-more" data-post-id="' + post.id + '"><img src="icons/more.svg" width="20" height="20" alt=""></button>';
                    allHtml += '</div>';
                    allHtml += '</div>';
                    if (safeText.trim() != '') {
                        allHtml += '<p class="thread-post-text">' + safeText + '</p>';
                    }
                    allHtml += imageHtml;
                    allHtml += '<div class="thread-post-actions">';
                    allHtml += '<button class="action-btn"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>';
                    allHtml += '<button class="action-btn"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></button>';
                    allHtml += '<button class="action-btn"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg></button>';
                    allHtml += '<button class="action-btn"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg></button>';
                    allHtml += '</div>';
                    allHtml += '</div>';
                }

                if (allHtml == '') {
                    allHtml = '<p style="text-align:center;color:#999;padding:40px 20px;">No posts yet.</p>';
                }

                threadContent.innerHTML = allHtml;

                // event delegation for thread menu
                threadContent.onclick = function(e) {
                    // handle more button click
                    let moreBtn = e.target.closest('.thread-post-more');
                    if (moreBtn) {
                        e.stopPropagation();
                        let post = moreBtn.closest('.thread-post');
                        if (!post) return;
                        let overlay = post.querySelector('.thread-menu-overlay');
                        let dropdown = post.querySelector('.thread-menu-dropdown');
                        if (!dropdown) return;
                        let isOpen = dropdown.classList.contains('active');
                        // close all open ones
                        closeAllThreadMenus();
                        if (!isOpen) {
                            dropdown.classList.add('active');
                            if (overlay) overlay.classList.add('active');
                        }
                        return;
                    }
                    // handle overlay click to close
                    let ov = e.target.closest('.thread-menu-overlay');
                    if (ov) {
                        closeAllThreadMenus();
                        return;
                    }
                };

                function closeAllThreadMenus() {
                    var allOverlays = threadContent.querySelectorAll('.thread-menu-overlay.active');
                    var allDropdowns = threadContent.querySelectorAll('.thread-menu-dropdown.active');
                    for (var d = 0; d < allDropdowns.length; d++) allDropdowns[d].classList.remove('active');
                    for (var d = 0; d < allOverlays.length; d++) allOverlays[d].classList.remove('active');
                }
                threadOverlay.classList.add('active');
                hidePostToast();
            };
        }

        // Thread back button
        if (threadBackBtn != null && threadOverlay != null) {
            threadBackBtn.onclick = function() {
                threadOverlay.classList.remove('active');
            };
        }

        // Drafts view toggle (inside same modal)
        let draftsBtn = document.getElementById('draftsBtn');
        let draftsView = document.getElementById('draftsView');
        let draftsBackBtn = document.getElementById('draftsBackBtn');
        let createPostForm = document.getElementById('createPostForm');
        if (draftsBtn && draftsView && createPostForm) {
            draftsBtn.onclick = function(e) {
                e.stopPropagation();
                createPostForm.style.display = 'none';
                draftsView.style.display = 'flex';
            };
            if (draftsBackBtn) {
                draftsBackBtn.onclick = function(e) {
                    e.stopPropagation();
                    draftsView.style.display = 'none';
                    createPostForm.style.display = '';
                };
            }
        }

        // More menu dropdown
        let moreMenuBtn2 = document.getElementById('moreMenuBtn');
        let moreMenuDropdown2 = document.getElementById('moreMenuDropdown');
        if (moreMenuBtn2 && moreMenuDropdown2) {
            moreMenuBtn2.addEventListener('click', function(e) {
                e.stopPropagation();
                if (moreMenuDropdown2.classList.contains('active')) {
                    moreMenuDropdown2.classList.remove('active');
                } else {
                    moreMenuDropdown2.classList.add('active');
                }
            });
            document.addEventListener('click', function(e) {
                if (!moreMenuDropdown2.contains(e.target) && !moreMenuBtn2.contains(e.target)) {
                    moreMenuDropdown2.classList.remove('active');
                }
            });
        }

        // close thread post more dropdowns on outside click
        document.addEventListener('click', function(e) {
            if (e.target.closest('.thread-post-more-container') == null) {
                let allTpDropdowns = document.querySelectorAll('.thread-post-more-dropdown.active');
                for (let i = 0; i < allTpDropdowns.length; i++) {
                    allTpDropdowns[i].classList.remove('active');
                }
            }
        });

        // FAB - open create post modal
        let fab = document.getElementById('fab');
        if (fab) {
            fab.onclick = function() {
                if (modalOverlay) modalOverlay.classList.add('from-fab');
                fab.style.display = 'none';
                openModal();
            };
        }

        // menu dropdown
        let menuBtn = document.getElementById('menuBtn');
        let menuDropdown = document.getElementById('menuDropdown');
        let menuMain = document.getElementById('menuMain');
        let menuAppearanceSubmenu = document.getElementById('menuAppearanceSubmenu');
        let menuFeedsSubmenu = document.getElementById('menuFeedsSubmenu');
        let appearanceBtn = document.getElementById('appearanceBtn');
        let appearanceBackBtn = document.getElementById('appearanceBackBtn');
        let logoutBtn = document.getElementById('logoutBtn');

        if (menuBtn && menuDropdown) {
            menuBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (menuMain) menuMain.style.display = 'block';
                if (menuAppearanceSubmenu) menuAppearanceSubmenu.classList.remove('active');
                if (menuFeedsSubmenu) menuFeedsSubmenu.classList.remove('active');
                if (menuDropdown.classList.contains('active')) {
                    menuDropdown.classList.remove('active');
                } else {
                    menuDropdown.classList.add('active');
                }
            });

            document.addEventListener('click', function(e) {
                if (!menuDropdown.contains(e.target) && !menuBtn.contains(e.target)) {
                    menuDropdown.classList.remove('active');
                    if (menuMain) menuMain.style.display = 'block';
                    if (menuAppearanceSubmenu) menuAppearanceSubmenu.classList.remove('active');
                    if (menuFeedsSubmenu) menuFeedsSubmenu.classList.remove('active');
                }
            });
        }

        if (appearanceBtn) {
            appearanceBtn.onclick = function(e) {
                e.stopPropagation();
                if (menuMain) menuMain.style.display = 'none';
                if (menuAppearanceSubmenu) menuAppearanceSubmenu.classList.add('active');
            };
        }

        if (appearanceBackBtn) {
            appearanceBackBtn.onclick = function(e) {
                e.stopPropagation();
                if (menuAppearanceSubmenu) menuAppearanceSubmenu.classList.remove('active');
                if (menuMain) menuMain.style.display = 'block';
            };
        }

        // Feeds submenu
        let menuFeedsBtn = document.getElementById('menuFeedsBtn');
        let menuFeedsBackBtn = document.getElementById('menuFeedsBackBtn');

        if (menuFeedsBtn && menuMain && menuFeedsSubmenu) {
            menuFeedsBtn.onclick = function(e) {
                e.stopPropagation();
                menuMain.style.display = 'none';
                menuFeedsSubmenu.classList.add('active');
            };
        }

        if (menuFeedsBackBtn && menuMain && menuFeedsSubmenu) {
            menuFeedsBackBtn.onclick = function(e) {
                e.stopPropagation();
                menuFeedsSubmenu.classList.remove('active');
                menuMain.style.display = 'block';
            };
        }

        // appearance options
        let appearanceOptions = menuDropdown ? menuDropdown.querySelectorAll('.appearance-option') : [];
        for (let i = 0; i < appearanceOptions.length; i++) {
            let btn = appearanceOptions[i];
            btn.onclick = function(e) {
                e.stopPropagation();
                let theme = this.getAttribute('data-theme');
                for (let j = 0; j < appearanceOptions.length; j++) {
                    appearanceOptions[j].classList.remove('active');
                }
                this.classList.add('active');
                if (theme == 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('threads_theme', JSON.stringify('dark'));
                } else if (theme == 'light') {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('threads_theme', JSON.stringify('light'));
                } else {
                    localStorage.setItem('threads_theme', JSON.stringify('auto'));
                    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                    } else {
                        document.documentElement.setAttribute('data-theme', 'light');
                    }
                }
            };
        }

        // logout
        if (logoutBtn) {
            logoutBtn.onclick = function() {
                localStorage.removeItem('threads_is_logged_in');
                localStorage.removeItem('threads_user');
                window.location.href = 'login.html';
            };
        }

        // Mobile menu dropdown
        let mobileMenuBtn = document.getElementById('mobileMenuBtn');
        let mobileMenuDropdown = document.getElementById('mobileMenuDropdown');
        let mobileMenuMain = document.getElementById('mobileMenuMain');
        let mobileAppearanceSubmenu = document.getElementById('mobileAppearanceSubmenu');
        let mobileFeedsSubmenu = document.getElementById('mobileFeedsSubmenu');

        if (mobileMenuBtn != null && mobileMenuDropdown != null) {
            mobileMenuBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (mobileMenuMain) mobileMenuMain.style.display = '';
                if (mobileAppearanceSubmenu) mobileAppearanceSubmenu.classList.remove('active');
                if (mobileFeedsSubmenu) mobileFeedsSubmenu.classList.remove('active');
                mobileMenuDropdown.classList.toggle('active');
            });

            document.addEventListener('click', function(e) {
                if (!mobileMenuDropdown.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    mobileMenuDropdown.classList.remove('active');
                    if (mobileMenuMain) mobileMenuMain.style.display = '';
                    if (mobileAppearanceSubmenu) mobileAppearanceSubmenu.classList.remove('active');
                    if (mobileFeedsSubmenu) mobileFeedsSubmenu.classList.remove('active');
                }
            });

            // Mobile Appearance submenu
            let mobileAppearanceBtn = document.getElementById('mobileAppearanceBtn');
            let mobileAppearanceBackBtn = document.getElementById('mobileAppearanceBackBtn');

            if (mobileAppearanceBtn) {
                mobileAppearanceBtn.onclick = function(e) {
                    e.stopPropagation();
                    mobileMenuMain.style.display = 'none';
                    mobileAppearanceSubmenu.classList.add('active');
                };
            }

            if (mobileAppearanceBackBtn) {
                mobileAppearanceBackBtn.onclick = function(e) {
                    e.stopPropagation();
                    mobileAppearanceSubmenu.classList.remove('active');
                    mobileMenuMain.style.display = '';
                };
            }

            // Mobile Appearance theme options
            let mobileAppearanceOptions = mobileMenuDropdown.querySelectorAll('.appearance-option');
            for (let i = 0; i < mobileAppearanceOptions.length; i++) {
                mobileAppearanceOptions[i].onclick = function(e) {
                    e.stopPropagation();
                    let theme = this.getAttribute('data-theme');
                    for (let j = 0; j < mobileAppearanceOptions.length; j++) {
                        mobileAppearanceOptions[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if (theme == 'light') {
                        document.documentElement.setAttribute('data-theme', 'light');
                        localStorage.setItem('threads_theme', JSON.stringify('light'));
                    } else if (theme == 'dark') {
                        document.documentElement.setAttribute('data-theme', 'dark');
                        localStorage.setItem('threads_theme', JSON.stringify('dark'));
                    } else {
                        localStorage.setItem('threads_theme', JSON.stringify('auto'));
                        if (!window.matchMedia('(prefers-color-scheme: dark)').matches) {
                            document.documentElement.setAttribute('data-theme', 'light');
                        } else {
                            document.documentElement.setAttribute('data-theme', 'dark');
                        }
                    }
                };
            }

            // Mobile Feeds submenu
            let mobileFeedsBtn = document.getElementById('mobileFeedsBtn');
            let mobileFeedsBackBtn = document.getElementById('mobileFeedsBackBtn');

            if (mobileFeedsBtn) {
                mobileFeedsBtn.onclick = function(e) {
                    e.stopPropagation();
                    mobileMenuMain.style.display = 'none';
                    mobileFeedsSubmenu.classList.add('active');
                };
            }

            if (mobileFeedsBackBtn) {
                mobileFeedsBackBtn.onclick = function(e) {
                    e.stopPropagation();
                    mobileFeedsSubmenu.classList.remove('active');
                    mobileMenuMain.style.display = '';
                };
            }

            // Mobile Logout
            let mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
            if (mobileLogoutBtn) {
                mobileLogoutBtn.onclick = function() {
                    localStorage.removeItem('threads_is_logged_in');
                    localStorage.removeItem('threads_user');
                    window.location.href = 'login.html';
                };
            }
        }

        // Edit Profile Modal
        let editProfileBtn = document.getElementById('editProfileBtn');
        let editProfileOverlay = document.getElementById('editProfileOverlay');
        let editDoneBtn = document.getElementById('editDoneBtn');
        let editBio = document.getElementById('editBio');
        let editName = document.getElementById('editName');
        let editAvatar = document.getElementById('editAvatar');
        let igBadgeToggle = document.getElementById('igBadgeToggle');

        // open edit profile
        if (editProfileBtn) {
            editProfileBtn.onclick = function() {
                if (!currentUser) return;
                let displayName = currentUser.name;
                if (!displayName) {
                    displayName = currentUser.username;
                }
                editName.textContent = displayName + ' (@' + currentUser.username + ')';
                if (currentUser.avatar) {
                    editAvatar.src = currentUser.avatar;
                } else {
                    editAvatar.src = '';
                }
                let savedBio = localStorage.getItem('threads_profile_bio');
                if (savedBio) {
                    editBio.value = savedBio;
                } else {
                    editBio.value = "U glow differently ,when your confidence is fueled by belief in yourself instead of validation from others. Sport : Queen of climbing";
                }
                let badgeState = localStorage.getItem('threads_ig_badge');
                if (badgeState == 'true') {
                    igBadgeToggle.classList.add('active');
                } else {
                    igBadgeToggle.classList.remove('active');
                }
                editProfileOverlay.classList.add('active');
            };
        }

        // toggle instagram badge
        if (igBadgeToggle) {
            igBadgeToggle.onclick = function() {
                if (this.classList.contains('active')) {
                    this.classList.remove('active');
                } else {
                    this.classList.add('active');
                }
            };
        }

        // close / save edit profile
        if (editDoneBtn) {
            editDoneBtn.onclick = function() {
                // Show loading spinner
                editDoneBtn.disabled = true;
                editDoneBtn.innerHTML = '<span class="edit-done-spinner"></span>';

                setTimeout(function() {
                    // Save data
                    let newBio = editBio.value.trim();
                    if (newBio) {
                        localStorage.setItem('threads_profile_bio', newBio);
                        document.getElementById('profileBio').textContent = newBio;
                    }
                    let badgeValue = 'false';
                    if (igBadgeToggle.classList.contains('active')) {
                        badgeValue = 'true';
                    }
                    localStorage.setItem('threads_ig_badge', badgeValue);

                    // Show checkmark
                    editDoneBtn.innerHTML = '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';

                    setTimeout(function() {
                        editProfileOverlay.classList.remove('active');
                        // Reset button
                        editDoneBtn.disabled = false;
                        editDoneBtn.innerHTML = 'Done';
                    }, 600);
                }, 800);
            };
        }

        // close on overlay click
        if (editProfileOverlay) {
            editProfileOverlay.addEventListener('click', function(e) {
                if (e.target == editProfileOverlay) {
                    editProfileOverlay.classList.remove('active');
                }
            });
        }

        // Page header menu dropdown
        let pageHeaderMenuBtn = document.getElementById('pageHeaderMenuBtn');
        let pageHeaderDropdown = document.getElementById('pageHeaderDropdown');
        if (pageHeaderMenuBtn && pageHeaderDropdown) {
            pageHeaderMenuBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                pageHeaderDropdown.classList.toggle('active');
            });
            document.addEventListener('click', function(e) {
                if (!pageHeaderDropdown.contains(e.target) && !pageHeaderMenuBtn.contains(e.target)) {
                    pageHeaderDropdown.classList.remove('active');
                }
            });
        }

        // Links modal
        let linksBtn = document.getElementById('linksBtn');
        let linksModalOverlay = document.getElementById('linksModalOverlay');
        let linksBackBtn = document.getElementById('linksBackBtn');
        let linksSelectedList = document.getElementById('linksSelectedList');
        let linksDisplay = document.getElementById('linksDisplay');
        let linksListView = document.getElementById('linksListView');
        let linksAddView = document.getElementById('linksAddView');
        let linksAddRowBtn = document.getElementById('linksAddRowBtn');
        let linksAddBackBtn = document.getElementById('linksAddBackBtn');
        let linksDoneBtn = document.getElementById('linksDoneBtn');
        let linksUrlInput = document.getElementById('linksUrlInput');
        let linksTitleInput = document.getElementById('linksTitleInput');
        let selectedLinks = []; // Array of { title, url }

        // Load saved links (with backward compat for old string arrays)
        try {
            let saved = localStorage.getItem('threads_links');
            if (saved) {
                let parsed = JSON.parse(saved) || [];
                selectedLinks = parsed.map(function(item) {
                    if (typeof item === 'string') {
                        return { title: item, url: item };
                    }
                    return item;
                }).filter(function(item) {
                    return item && item.url && !item.url.includes('<') && !item.url.includes('>');
                });
                // Re-save clean data
                localStorage.setItem('threads_links', JSON.stringify(selectedLinks));
            }
        } catch(e) {
            localStorage.removeItem('threads_links');
        }

        function updateLinksDisplay() {
            if (!linksDisplay) return;
            if (selectedLinks.length == 0) {
                linksDisplay.textContent = '';
            } else {
                linksDisplay.textContent = selectedLinks.length;
            }
            localStorage.setItem('threads_links', JSON.stringify(selectedLinks));
        }

        let chainIconSvg = '<svg width="20" height="20" viewBox="2 2 16 16" fill="none" stroke="currentColor">' +
            '<path d="M8.39992 5.44993L9.50669 4.34316C11.2046 2.64524 13.9575 2.64524 15.6554 4.34316V4.34316V4.34316C17.3533 6.04108 17.3533 8.79396 15.6554 10.4919L14.5486 11.5987" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"/>' +
            '<path d="M5.44773 8.40114L4.34096 9.50791C2.64304 11.2058 2.64304 13.9587 4.34096 15.6566V15.6566V15.6566C6.03889 17.3546 8.79176 17.3546 10.4897 15.6566L11.5965 14.5499" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"/>' +
            '<path d="M12.7051 7.29565L7.2942 12.7065" stroke="currentColor" stroke-linecap="round" stroke-width="1.65"/>' +
            '</svg>';

        function renderSelectedLinks() {
            if (!linksSelectedList) return;
            let html = '';
            for (let i = 0; i < selectedLinks.length; i++) {
                let link = selectedLinks[i];
                let displayTitle = link.title || link.url;
                html += '<div class="links-card">';
                html += '<span class="links-card-icon">' + chainIconSvg + '</span>';
                html += '<div class="links-card-info">';
                html += '<div class="links-card-title">' + displayTitle + '</div>';
                html += '<div class="links-card-url">' + link.url + '</div>';
                html += '</div>';
                html += '<button class="links-card-remove" data-index="' + i + '">';
                html += '<svg width="16" height="16" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="8.25" stroke="currentColor" stroke-width="1.5"></circle><path d="M13.5985 9.82813H6.39855" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"></path></svg>';
                html += '</button>';
                html += '</div>';
            }
            linksSelectedList.innerHTML = html;

            // Add remove handlers
            let removeBtns = linksSelectedList.querySelectorAll('.links-card-remove');
            for (let i = 0; i < removeBtns.length; i++) {
                removeBtns[i].addEventListener('click', function() {
                    let index = parseInt(this.getAttribute('data-index'));
                    selectedLinks.splice(index, 1);
                    renderSelectedLinks();
                    updateLinksDisplay();
                });
            }
        }

        function showLinksListView() {
            linksListView.style.display = 'block';
            linksAddView.style.display = 'none';
            renderSelectedLinks();
        }

        function updateDoneBtn() {
            if (!linksDoneBtn) return;
            if (linksUrlInput.value.trim().length > 0) {
                linksDoneBtn.classList.remove('disabled');
            } else {
                linksDoneBtn.classList.add('disabled');
            }
        }

        function showLinksAddView() {
            linksListView.style.display = 'none';
            linksAddView.style.display = 'block';
            let linksError = document.getElementById('linksError');
            if (linksError) linksError.classList.remove('show');

            // Destroy and recreate inputs to prevent browser autofill
            let urlParent = linksUrlInput.parentNode;
            let titleParent = linksTitleInput.parentNode;
            linksUrlInput.remove();
            linksTitleInput.remove();

            let newUrl = document.createElement('input');
            newUrl.type = 'text';
            newUrl.className = 'links-add-form-input';
            newUrl.id = 'linksUrlInput';
            newUrl.name = 'links_url_' + Date.now();
            newUrl.placeholder = 'URL';
            newUrl.setAttribute('autocomplete', 'off');
            urlParent.appendChild(newUrl);

            let newTitle = document.createElement('input');
            newTitle.type = 'text';
            newTitle.className = 'links-add-form-input';
            newTitle.id = 'linksTitleInput';
            newTitle.name = 'links_title_' + Date.now();
            newTitle.placeholder = 'Title (optional)';
            newTitle.setAttribute('autocomplete', 'off');
            titleParent.appendChild(newTitle);

            linksUrlInput = newUrl;
            linksTitleInput = newTitle;

            // Re-attach input listener
            linksUrlInput.addEventListener('input', function() {
                updateDoneBtn();
                let err = document.getElementById('linksError');
                if (err) err.classList.remove('show');
            });

            updateDoneBtn();
            linksUrlInput.focus();
        }

        // Initial display update
        updateLinksDisplay();

        // Open links modal
        if (linksBtn && linksModalOverlay) {
            linksBtn.onclick = function() {
                showLinksListView();
                renderSelectedLinks();
                linksModalOverlay.classList.add('active');
            };
        }

        // Close links modal (back button on list view)
        if (linksBackBtn && linksModalOverlay) {
            linksBackBtn.onclick = function() {
                linksModalOverlay.classList.remove('active');
            };
        }

        // Close on overlay click
        if (linksModalOverlay) {
            linksModalOverlay.addEventListener('click', function(e) {
                if (e.target == linksModalOverlay) {
                    linksModalOverlay.classList.remove('active');
                }
            });
        }

        // "Add Link" row -> show add form
        if (linksAddRowBtn) {
            linksAddRowBtn.onclick = function() {
                showLinksAddView();
            };
        }

        // Back from add form -> list view
        if (linksAddBackBtn) {
            linksAddBackBtn.onclick = function() {
                showLinksListView();
            };
        }

        // Input listeners are attached dynamically in showLinksAddView()

        function isValidUrl(str) {
            try {
                let u = new URL(str);
                return u.protocol === 'http:' || u.protocol === 'https:';
            } catch(e) {
                return false;
            }
        }

        function showLinksToast(msg) {
            let existing = document.querySelector('.links-toast');
            if (existing) existing.remove();
            let toast = document.createElement('div');
            toast.className = 'links-toast';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(function() { toast.classList.add('show'); }, 10);
            setTimeout(function() {
                toast.classList.remove('show');
                setTimeout(function() { toast.remove(); }, 300);
            }, 2500);
        }

        // Done button -> validate and save link
        if (linksDoneBtn) {
            linksDoneBtn.onclick = function() {
                let url = linksUrlInput.value.trim();
                if (url.length == 0) {
                    showLinksListView();
                    return;
                }
                if (!isValidUrl(url)) {
                    let linksError = document.getElementById('linksError');
                    let isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                    if (isDark) {
                        if (linksError) linksError.classList.add('show');
                    } else {
                        showLinksToast('Please enter a valid URL.');
                    }
                    return;
                }
                let title = linksTitleInput.value.trim();
                selectedLinks.push({ title: title || '', url: url });
                renderSelectedLinks();
                updateLinksDisplay();
                showLinksListView();
            };
        }

        // Podcast modal
        let podcastBtn = document.getElementById('podcastBtn');
        let podcastModalOverlay = document.getElementById('podcastModalOverlay');
        let podcastBackBtn = document.getElementById('podcastBackBtn');
        let podcastDoneBtn = document.getElementById('podcastDoneBtn');
        let podcastUrlInput = document.getElementById('podcastUrlInput');
        let podcastDisplay = document.getElementById('podcastDisplay');
        let savedPodcast = '';

        // Load saved podcast
        try {
            savedPodcast = localStorage.getItem('threads_podcast') || '';
        } catch(e) {}

        function updatePodcastDisplay() {
            if (!podcastDisplay) return;
            if (savedPodcast) {
                podcastDisplay.textContent = '1';
            } else {
                podcastDisplay.textContent = '';
            }
        }

        function updatePodcastDoneBtn() {
            if (!podcastDoneBtn) return;
            if (podcastUrlInput && podcastUrlInput.value.trim().length > 0) {
                podcastDoneBtn.classList.remove('disabled');
            } else {
                podcastDoneBtn.classList.add('disabled');
            }
        }

        updatePodcastDisplay();

        // Open podcast modal
        if (podcastBtn && podcastModalOverlay) {
            podcastBtn.onclick = function() {
                podcastModalOverlay.classList.add('active');
                // Recreate input to prevent autofill
                let urlField = document.getElementById('podcastUrlField');
                let oldInput = document.getElementById('podcastUrlInput');
                if (oldInput) oldInput.remove();
                let newInput = document.createElement('input');
                newInput.type = 'text';
                newInput.className = 'podcast-form-input';
                newInput.id = 'podcastUrlInput';
                newInput.name = 'podcast_url_' + Date.now();
                newInput.placeholder = 'URL';
                newInput.value = savedPodcast;
                urlField.appendChild(newInput);
                podcastUrlInput = newInput;
                podcastUrlInput.addEventListener('input', function() {
                    updatePodcastDoneBtn();
                    let err = document.getElementById('podcastError');
                    if (err) err.classList.remove('show');
                });
                updatePodcastDoneBtn();
                let err = document.getElementById('podcastError');
                if (err) err.classList.remove('show');
            };
        }

        // Close podcast modal
        if (podcastBackBtn && podcastModalOverlay) {
            podcastBackBtn.onclick = function() {
                podcastModalOverlay.classList.remove('active');
            };
        }

        if (podcastModalOverlay) {
            podcastModalOverlay.addEventListener('click', function(e) {
                if (e.target == podcastModalOverlay) {
                    podcastModalOverlay.classList.remove('active');
                }
            });
        }

        function isValidPodcastUrl(str) {
            if (!isValidUrl(str)) return false;
            try {
                let u = new URL(str);
                let host = u.hostname.toLowerCase();
                return host.includes('spotify.com') || host.includes('apple.com') || host.includes('iheart.com');
            } catch(e) {
                return false;
            }
        }

        // Done button - validate and save
        if (podcastDoneBtn) {
            podcastDoneBtn.onclick = function() {
                let url = podcastUrlInput ? podcastUrlInput.value.trim() : '';
                if (url.length == 0) {
                    podcastModalOverlay.classList.remove('active');
                    return;
                }
                if (!isValidPodcastUrl(url)) {
                    let isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                    let podcastError = document.getElementById('podcastError');
                    if (isDark) {
                        if (podcastError) podcastError.classList.add('show');
                    } else {
                        showLinksToast('Invalid link');
                    }
                    return;
                }
                savedPodcast = url;
                localStorage.setItem('threads_podcast', savedPodcast);
                updatePodcastDisplay();
                podcastModalOverlay.classList.remove('active');
            };
        }

        // Interests modal
        let interestsBtn = document.getElementById('interestsBtn');
        let interestsModalOverlay = document.getElementById('interestsModalOverlay');
        let interestsBackBtn = document.getElementById('interestsBackBtn');
        let interestsInput = document.getElementById('interestsInput');
        let interestsSuggestions = document.getElementById('interestsSuggestions');

        // Sample topics data
        let topicsData = [
            // Dance
            { name: 'dance', posts: 445 },
            { name: 'Dance Threads', posts: 120 },
            { name: 'dancer', posts: 380 },
            { name: 'dancechallenge', posts: 256 },
            { name: 'dancers', posts: 312 },
            { name: 'dancehall', posts: 189 },
            { name: 'dancemusic', posts: 234 },
            { name: 'dancersofthreads', posts: 98 },
            { name: 'ballet', posts: 234 },
            { name: 'hiphop', posts: 567 },
            { name: 'salsa', posts: 189 },
            { name: 'contemporary', posts: 145 },
            // Singing & Music
            { name: 'sing', posts: 320 },
            { name: 'singer', posts: 890 },
            { name: 'singing', posts: 567 },
            { name: 'vocalist', posts: 234 },
            { name: 'karaoke', posts: 178 },
            { name: 'music', posts: 890 },
            { name: 'musician', posts: 456 },
            { name: 'guitar', posts: 678 },
            { name: 'piano', posts: 456 },
            { name: 'drums', posts: 234 },
            { name: 'violin', posts: 189 },
            // Painting & Art
            { name: 'paint', posts: 456 },
            { name: 'painting', posts: 1200 },
            { name: 'painter', posts: 567 },
            { name: 'watercolor', posts: 345 },
            { name: 'oilpainting', posts: 234 },
            { name: 'acrylic', posts: 189 },
            { name: 'art', posts: 2300 },
            { name: 'artist', posts: 1800 },
            { name: 'artwork', posts: 1500 },
            { name: 'drawing', posts: 1100 },
            { name: 'sketch', posts: 890 },
            { name: 'illustration', posts: 780 },
            { name: 'digitalart', posts: 670 },
            // Photography
            { name: 'photography', posts: 3400 },
            { name: 'photographer', posts: 2100 },
            { name: 'photo', posts: 1800 },
            { name: 'portrait', posts: 890 },
            { name: 'landscape', posts: 670 },
            // Sports & Fitness
            { name: 'climbing', posts: 567 },
            { name: 'climber', posts: 234 },
            { name: 'climbinglife', posts: 189 },
            { name: 'bouldering', posts: 234 },
            { name: 'fitness', posts: 1200 },
            { name: 'fitnessmotivation', posts: 890 },
            { name: 'gym', posts: 1100 },
            { name: 'workout', posts: 980 },
            { name: 'yoga', posts: 1500 },
            { name: 'running', posts: 890 },
            { name: 'cycling', posts: 670 },
            { name: 'swimming', posts: 456 },
            { name: 'soccer', posts: 890 },
            { name: 'basketball', posts: 780 },
            { name: 'tennis', posts: 456 },
            { name: 'golf', posts: 345 },
            { name: 'hiking', posts: 670 },
            { name: 'surfing', posts: 456 },
            { name: 'skiing', posts: 345 },
            { name: 'snowboarding', posts: 289 },
            // Crafts & DIY
            { name: 'crafts', posts: 567 },
            { name: 'diy', posts: 890 },
            { name: 'handmade', posts: 670 },
            { name: 'knitting', posts: 345 },
            { name: 'crochet', posts: 289 },
            { name: 'sewing', posts: 234 },
            { name: 'embroidery', posts: 189 },
            { name: 'pottery', posts: 234 },
            { name: 'woodworking', posts: 189 },
            { name: 'jewelry', posts: 345 },
            // Gaming
            { name: 'gaming', posts: 2100 },
            { name: 'gamer', posts: 1800 },
            { name: 'videogames', posts: 1500 },
            { name: 'esports', posts: 670 },
            { name: 'streaming', posts: 890 },
            { name: 'twitch', posts: 567 },
            // Reading & Writing
            { name: 'reading', posts: 1200 },
            { name: 'books', posts: 1500 },
            { name: 'bookworm', posts: 670 },
            { name: 'writing', posts: 890 },
            { name: 'writer', posts: 780 },
            { name: 'poetry', posts: 456 },
            { name: 'author', posts: 345 },
            // Cooking & Food
            { name: 'cooking', posts: 1800 },
            { name: 'chef', posts: 670 },
            { name: 'baking', posts: 890 },
            { name: 'recipes', posts: 780 },
            { name: 'food', posts: 5600 },
            { name: 'foodie', posts: 3400 },
            { name: 'vegan', posts: 890 },
            { name: 'vegetarian', posts: 670 },
            // Travel
            { name: 'travel', posts: 4500 },
            { name: 'traveler', posts: 2300 },
            { name: 'adventure', posts: 1800 },
            { name: 'explore', posts: 1500 },
            { name: 'wanderlust', posts: 1200 },
            { name: 'backpacking', posts: 670 },
            // Fashion & Beauty
            { name: 'fashion', posts: 4200 },
            { name: 'style', posts: 3100 },
            { name: 'ootd', posts: 1800 },
            { name: 'makeup', posts: 2100 },
            { name: 'beauty', posts: 1900 },
            { name: 'skincare', posts: 1500 },
            { name: 'nails', posts: 890 },
            { name: 'hair', posts: 1100 },
            // Nature & Outdoors
            { name: 'nature', posts: 2300 },
            { name: 'outdoors', posts: 1200 },
            { name: 'camping', posts: 670 },
            { name: 'gardening', posts: 890 },
            { name: 'plants', posts: 1100 },
            { name: 'flowers', posts: 780 },
            // Pets & Animals
            { name: 'pets', posts: 1800 },
            { name: 'dogs', posts: 2300 },
            { name: 'cats', posts: 2100 },
            { name: 'animals', posts: 1500 },
            // Tech
            { name: 'tech', posts: 1200 },
            { name: 'coding', posts: 890 },
            { name: 'programming', posts: 780 },
            { name: 'developer', posts: 670 },
            // Movies & Entertainment
            { name: 'movies', posts: 1800 },
            { name: 'films', posts: 1200 },
            { name: 'cinema', posts: 670 },
            { name: 'netflix', posts: 890 },
            { name: 'anime', posts: 1500 },
            { name: 'kpop', posts: 1800 },
            // Meditation & Wellness
            { name: 'meditation', posts: 670 },
            { name: 'mindfulness', posts: 456 },
            { name: 'wellness', posts: 890 },
            { name: 'selfcare', posts: 1100 },
            { name: 'mentalhealth', posts: 780 }
        ];

        if (interestsBtn && interestsModalOverlay) {
            interestsBtn.onclick = function() {
                renderSelectedInterests();
                interestsModalOverlay.classList.add('active');
            };
        }

        if (interestsBackBtn && interestsModalOverlay) {
            interestsBackBtn.onclick = function() {
                interestsModalOverlay.classList.remove('active');
            };
        }

        if (interestsModalOverlay) {
            interestsModalOverlay.addEventListener('click', function(e) {
                if (e.target == interestsModalOverlay) {
                    interestsModalOverlay.classList.remove('active');
                }
            });
        }

        // Interests autocomplete
        let interestsSelectedList = document.getElementById('interestsSelectedList');
        let interestsDisplay = document.getElementById('interestsDisplay');
        let selectedInterests = [];

        // Load saved interests or use defaults
        try {
            let saved = localStorage.getItem('threads_interests');
            if (saved) {
                let parsed = JSON.parse(saved);
                if (parsed && parsed.length > 0) {
                    selectedInterests = parsed;
                } else {
                    selectedInterests = ['dance', 'singlelife'];
                    localStorage.setItem('threads_interests', JSON.stringify(selectedInterests));
                }
            } else {
                selectedInterests = ['dance', 'singlelife'];
                localStorage.setItem('threads_interests', JSON.stringify(selectedInterests));
            }
        } catch(e) {}

        function updateInterestsDisplay() {
            if (!interestsDisplay) return;
            if (selectedInterests.length == 0) {
                interestsDisplay.textContent = 'Add interests';
                interestsDisplay.classList.add('placeholder');
            } else {
                interestsDisplay.textContent = selectedInterests.join(', ');
                interestsDisplay.classList.remove('placeholder');
            }
            // Save to localStorage
            localStorage.setItem('threads_interests', JSON.stringify(selectedInterests));
        }


        function renderSelectedInterests() {
            if (!interestsSelectedList) return;
            let html = '';
            for (let i = 0; i < selectedInterests.length; i++) {
                html += '<div class="interests-selected-item">';
                html += '<span class="interests-selected-name">' + selectedInterests[i] + '</span>';
                html += '<button class="interests-remove-btn" data-index="' + i + '">';
                html += '<svg width="16" height="16" viewBox="0 0 20 20" fill="none"><circle cx="10" cy="10" r="8.25" stroke="currentColor" stroke-width="1.5"></circle><path d="M13.5985 9.82813H6.39855" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"></path></svg>';
                html += '</button>';
                html += '</div>';
            }
            interestsSelectedList.innerHTML = html;

            // Add remove handlers
            let removeBtns = interestsSelectedList.querySelectorAll('.interests-remove-btn');
            for (let i = 0; i < removeBtns.length; i++) {
                removeBtns[i].addEventListener('click', function() {
                    let index = parseInt(this.getAttribute('data-index'));
                    selectedInterests.splice(index, 1);
                    renderSelectedInterests();
                    updateInterestsDisplay();
                });
            }
        }

        // Initial display update
        updateInterestsDisplay();

        if (interestsInput && interestsSuggestions) {
            interestsInput.addEventListener('input', function() {
                let query = this.value.trim().toLowerCase();
                if (query.length == 0) {
                    interestsSuggestions.classList.remove('active');
                    interestsSuggestions.innerHTML = '';
                    return;
                }

                let matches = [];
                for (let i = 0; i < topicsData.length; i++) {
                    // Don't show already selected topics
                    if (selectedInterests.indexOf(topicsData[i].name) == -1 && topicsData[i].name.toLowerCase().includes(query)) {
                        matches.push(topicsData[i]);
                    }
                }

                if (matches.length == 0) {
                    interestsSuggestions.classList.remove('active');
                    interestsSuggestions.innerHTML = '';
                    return;
                }

                let html = '';
                for (let i = 0; i < matches.length; i++) {
                    html += '<div class="interests-suggestion-item" data-name="' + matches[i].name + '">';
                    html += '<span class="interests-suggestion-name">' + matches[i].name + '</span>';
                    html += '<span class="interests-suggestion-posts">' + matches[i].posts + ' recent posts</span>';
                    html += '</div>';
                }
                interestsSuggestions.innerHTML = html;
                interestsSuggestions.classList.add('active');

                // Add click handlers to suggestions
                let items = interestsSuggestions.querySelectorAll('.interests-suggestion-item');
                for (let i = 0; i < items.length; i++) {
                    items[i].addEventListener('click', function() {
                        let name = this.getAttribute('data-name');
                        if (selectedInterests.indexOf(name) == -1) {
                            selectedInterests.push(name);
                            renderSelectedInterests();
                            updateInterestsDisplay();
                        }
                        interestsInput.value = '';
                        interestsSuggestions.classList.remove('active');
                        interestsSuggestions.innerHTML = '';
                    });
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!interestsInput.contains(e.target) && !interestsSuggestions.contains(e.target)) {
                    interestsSuggestions.classList.remove('active');
                }
            });
        }

        // Close post menu dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.profile-post-menu')) {
                let allDropdowns = document.querySelectorAll('.post-menu-dropdown.active');
                for (let i = 0; i < allDropdowns.length; i++) {
                    allDropdowns[i].classList.remove('active');
                }
            }
        });

        // ======= DELETE POST - GLOBAL EVENT DELEGATION =======
        let pendingDeletePostId = null;

        // Single global click handler catches ALL delete buttons everywhere
        document.addEventListener('click', function(e) {
            // Check if clicked element or its parent has data-delete-post-id
            let deleteBtn = e.target.closest('[data-delete-post-id]');
            if (deleteBtn) {
                e.stopPropagation();
                e.preventDefault();
                pendingDeletePostId = deleteBtn.getAttribute('data-delete-post-id');
                // close any open menus
                let openMenu = deleteBtn.closest('.post-menu-dropdown, .thread-post-more-dropdown');
                if (openMenu) openMenu.classList.remove('active');
                // show confirmation modal
                let overlay = document.getElementById('deletePostOverlay');
                if (overlay) overlay.classList.add('active');
                return;
            }
        });

        // Cancel button
        document.getElementById('deletePostCancel').addEventListener('click', function() {
            pendingDeletePostId = null;
            document.getElementById('deletePostOverlay').classList.remove('active');
        });

        // Confirm delete button
        document.getElementById('deletePostConfirm').addEventListener('click', function() {
            if (pendingDeletePostId !== null && pendingDeletePostId !== undefined) {
                let raw = localStorage.getItem('threads_user_posts');
                let userPosts = raw ? JSON.parse(raw) : [];
                let newPosts = [];
                for (let i = 0; i < userPosts.length; i++) {
                    if (String(userPosts[i].id) !== String(pendingDeletePostId)) {
                        newPosts.push(userPosts[i]);
                    }
                }
                localStorage.setItem('threads_user_posts', JSON.stringify(newPosts));
            }

            pendingDeletePostId = null;

            // close delete modal
            document.getElementById('deletePostOverlay').classList.remove('active');

            // close thread overlay if open
            let threadOverlay = document.getElementById('threadOverlay');
            if (threadOverlay) threadOverlay.classList.remove('active');

            // re-render the active profile tab
            let activeTabEl = document.querySelector('.profile-tab.active');
            let tabName = activeTabEl ? activeTabEl.getAttribute('data-tab') : 'threads';
            if (tabName === 'threads') renderPosts();
            else if (tabName === 'media') renderMedia();
            else if (tabName === 'reposts') renderReposts();
        });

        // Click outside modal to cancel
        document.getElementById('deletePostOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                pendingDeletePostId = null;
                this.classList.remove('active');
            }
        });

        init();
        initSessionTimeout();
    </script>
</body>
</html>
