<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; script-src 'self' 'unsafe-inline';">
    <title>Find Your Account</title>
    <link rel="stylesheet" href="forgot-password.css">
    <script>
        (function() {
            let raw = localStorage.getItem('threads_theme');
            let savedTheme = 'auto';
            if (raw) savedTheme = JSON.parse(raw);
            if (savedTheme == 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
            } else if (savedTheme == 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                if (!window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'light');
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            }
        })();
    </script>
</head>
<body>
    <div class="fp-page">
        <!-- Back Arrow -->
        <div class="fp-back">
            <a href="instagram-login.html" class="fp-back-link">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"/>
                </svg>
            </a>
        </div>

        <!-- Main Content -->
        <main class="fp-main">
            <h1 class="fp-title">Find Your Account</h1>
            <p class="fp-desc">Enter your mobile number, username or email address. <a href="#" class="fp-help-link">Can't reset your password?</a></p>

            <form class="fp-form" id="fpForm" novalidate>
                <!-- honeypot anti-bot field -->
                <div style="position:absolute;left:-9999px;top:-9999px;" aria-hidden="true">
                    <input type="text" name="website" id="fpHoneypot" tabindex="-1" autocomplete="off">
                </div>
                <div class="fp-input-group">
                    <div class="fp-input-wrapper" id="fpInputWrapper">
                        <input type="text" class="fp-input" id="fpInput" placeholder=" " autocomplete="username" maxlength="75" aria-label="Mobile number, username or email address" spellcheck="false" autocorrect="off" autocapitalize="off">
                        <label class="fp-input-label" for="fpInput">Mobile number, username or email address</label>
                        <button type="button" class="fp-clear-btn" id="fpClearBtn" aria-label="Clear input" tabindex="-1">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>
                        </button>
                    </div>
                    <div class="fp-input-meta">
                        <span class="fp-error" id="fpError"></span>
                        <span class="fp-char-count" id="fpCharCount"></span>
                    </div>
                    <span class="fp-input-type" id="fpInputType"></span>
                </div>
                <p class="fp-notice">You may receive WhatsApp and SMS notifications from us for security and login purposes.</p>
                <div class="fp-lockout-bar" id="fpLockoutBar">
                    <div class="fp-lockout-fill" id="fpLockoutFill"></div>
                </div>
                <button type="submit" class="fp-continue-btn" id="fpContinueBtn">Continue</button>
            </form>
        </main>

        <!-- Footer -->
        <footer class="fp-footer">
            <nav class="fp-footer-links">
                <a href="#">Meta</a>
                <a href="#">About</a>
                <a href="#">Blog</a>
                <a href="#">Jobs</a>
                <a href="#">Help</a>
                <a href="#">API</a>
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
                <a href="#">Locations</a>
                <a href="#">Instagram Lite</a>
                <a href="#">Contact uploading and non-users</a>
                <a href="#">Meta Verified</a>
            </nav>
            <div class="fp-footer-bottom">
                <span class="fp-footer-lang">English (UK)
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                </span>
                <span class="fp-footer-copyright">&copy; 2026 Instagram from Meta</span>
            </div>
        </footer>
    </div>

    <script>
        // load saved theme
        let raw = localStorage.getItem('threads_theme');
        let savedTheme = 'auto';
        if (raw) {
            savedTheme = JSON.parse(raw);
        }
        if (savedTheme == 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else if (savedTheme == 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
        } else {
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        }
    </script>
    <script>
        (function() {
            let input = document.getElementById('fpInput');
            let btn = document.getElementById('fpContinueBtn');
            let form = document.getElementById('fpForm');
            let errorEl = document.getElementById('fpError');
            let clearBtn = document.getElementById('fpClearBtn');
            let charCount = document.getElementById('fpCharCount');
            let inputType = document.getElementById('fpInputType');
            let honeypot = document.getElementById('fpHoneypot');
            let lockoutBar = document.getElementById('fpLockoutBar');
            let lockoutFill = document.getElementById('fpLockoutFill');
            let wrapper = document.getElementById('fpInputWrapper');
            let submitting = false;
            let lockoutTimer = null;
            let debounceTimer = null;
            let pageLoadTime = Date.now();

            // restore lockout from sessionStorage (survives refresh)
            let attempts = parseInt(sessionStorage.getItem('fp_attempts') || '0');
            let lockoutUntil = parseInt(sessionStorage.getItem('fp_lockout') || '0');

            function saveLockoutState() {
                sessionStorage.setItem('fp_attempts', String(attempts));
                sessionStorage.setItem('fp_lockout', String(lockoutUntil));
            }

            // --- SANITIZATION ---

            // strip HTML tags and entities
            function sanitize(str) {
                let div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML.trim();
            }

            // block dangerous patterns (XSS, SQL injection, path traversal)
            function containsDangerousPattern(val) {
                let lower = val.toLowerCase();
                // script/html injection
                if (/<script|<\/script|javascript:|on\w+\s*=/i.test(val)) return true;
                if (/<[a-z][\s\S]*>/i.test(val)) return true;
                // SQL injection keywords
                if (/(\b(select|insert|update|delete|drop|union|alter|exec|execute)\b\s+(from|into|table|database|where|all))/i.test(val)) return true;
                if (/(['";]\s*(--)|(\/\*)|(\*\/)|(\bor\b\s+\d+\s*=\s*\d+))/i.test(val)) return true;
                // path traversal
                if (/\.\.\/|\.\.\\/.test(val)) return true;
                // null bytes
                if (/\x00/.test(val)) return true;
                return false;
            }

            // strip all control characters
            function stripControlChars(str) {
                return str.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, '');
            }

            // --- VALIDATION ---

            function validate(val) {
                if (val == null || val == '' || val.length < 1) {
                    return 'Please enter a username, email or phone number.';
                }
                // whitespace-only
                if (/^\s+$/.test(val)) {
                    return 'Input cannot be only spaces.';
                }
                if (val.length > 74) {
                    return 'Input is too long.';
                }
                // dangerous patterns
                if (containsDangerousPattern(val)) {
                    return 'Invalid characters detected.';
                }
                // email check
                if (val.indexOf('@') != -1) {
                    let emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailPattern.test(val)) {
                        return 'Please enter a valid email address.';
                    }
                    // check domain has valid TLD (2+ chars)
                    let domain = val.split('@')[1];
                    let tld = domain.split('.').pop();
                    if (tld.length < 2) {
                        return 'Please enter a valid email address.';
                    }
                    return '';
                }
                // phone check
                let strippedPhone = val.replace(/[\s\-()]/g, '');
                if (/^\+?\d+$/.test(strippedPhone)) {
                    let digits = val.replace(/\D/g, '');
                    if (digits.length < 6) {
                        return 'Phone number is too short.';
                    }
                    if (digits.length > 15) {
                        return 'Phone number is too long.';
                    }
                    return '';
                }
                // username check
                if (val.length < 3) {
                    return 'Username must be at least 3 characters.';
                }
                if (val.length > 30) {
                    return 'Username cannot exceed 30 characters.';
                }
                if (!/^[a-zA-Z0-9._]+$/.test(val)) {
                    return 'Invalid username. Only letters, numbers, periods and underscores are allowed.';
                }
                if (/^[._]|[._]$/.test(val)) {
                    return 'Username cannot start or end with a period or underscore.';
                }
                if (/[.]{2}|[_]{2}/.test(val)) {
                    return 'Username cannot contain consecutive periods or underscores.';
                }
                return '';
            }

            // --- UI HELPERS ---

            function showError(msg) {
                errorEl.textContent = msg;
                wrapper.classList.add('fp-input-error');
            }

            function clearError() {
                errorEl.textContent = '';
                wrapper.classList.remove('fp-input-error');
            }

            function shakeInput() {
                wrapper.classList.add('fp-shake');
                setTimeout(function() {
                    wrapper.classList.remove('fp-shake');
                }, 500);
            }

            function updateBtn() {
                if (submitting) return;
                let now = Date.now();
                btn.disabled = input.value.trim().length < 1 || now < lockoutUntil;
            }

            function updateClearBtn() {
                if (input.value.length > 0) {
                    clearBtn.style.display = 'flex';
                } else {
                    clearBtn.style.display = 'none';
                }
            }

            function updateCharCount() {
                let len = input.value.length;
                if (len > 50) {
                    charCount.textContent = len + '/75';
                    charCount.style.display = 'inline';
                    if (len > 70) {
                        charCount.style.color = '#ed4956';
                    } else {
                        charCount.style.color = '';
                    }
                } else {
                    charCount.style.display = 'none';
                }
            }

            // detect and show input type
            function updateInputType() {
                let val = input.value.trim();
                if (val.length == 0) {
                    inputType.textContent = '';
                    return;
                }
                if (val.indexOf('@') != -1) {
                    inputType.textContent = 'Email detected';
                } else {
                    let stripped = val.replace(/[\s\-()]/g, '');
                    if (/^\+?\d+$/.test(stripped) && val.replace(/\D/g, '').length >= 3) {
                        inputType.textContent = 'Phone number detected';
                    } else if (val.length >= 3) {
                        inputType.textContent = 'Username detected';
                    } else {
                        inputType.textContent = '';
                    }
                }
            }

            // --- LOCKOUT TIMER ---

            function startLockoutCountdown() {
                lockoutBar.style.display = 'block';
                function tick() {
                    let now = Date.now();
                    if (now >= lockoutUntil) {
                        lockoutBar.style.display = 'none';
                        lockoutFill.style.width = '0%';
                        clearError();
                        updateBtn();
                        lockoutTimer = null;
                        return;
                    }
                    let remaining = lockoutUntil - now;
                    let total = 60000;
                    let pct = ((total - remaining) / total) * 100;
                    lockoutFill.style.width = pct + '%';
                    let secs = Math.ceil(remaining / 1000);
                    showError('Too many attempts. Try again in ' + secs + 's.');
                    lockoutTimer = setTimeout(tick, 200);
                }
                tick();
            }

            // resume lockout if page was refreshed during lockout
            if (Date.now() < lockoutUntil) {
                startLockoutCountdown();
            }

            // --- EVENT LISTENERS ---

            // real-time input
            input.addEventListener('input', function() {
                clearError();
                updateBtn();
                updateClearBtn();
                updateCharCount();

                // debounced validation while typing
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(function() {
                    let val = input.value.trim();
                    if (val.length > 0) {
                        updateInputType();
                        // only show errors for dangerous patterns in real-time
                        if (containsDangerousPattern(val)) {
                            showError('Invalid characters detected.');
                        }
                    } else {
                        inputType.textContent = '';
                    }
                }, 300);
            });

            // blur validation + auto-trim
            input.addEventListener('blur', function() {
                // auto-trim whitespace
                let trimmed = input.value.trim();
                if (trimmed != input.value) {
                    input.value = trimmed;
                    updateClearBtn();
                    updateCharCount();
                }
                if (trimmed) {
                    let err = validate(trimmed);
                    if (err) showError(err);
                    updateInputType();
                }
            });

            // paste sanitization — strip HTML and dangerous content
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                let pasted = '';
                if (e.clipboardData) {
                    pasted = e.clipboardData.getData('text/plain');
                }
                // strip control chars and trim
                pasted = stripControlChars(pasted).trim();
                // limit length
                let maxRemaining = 75 - input.value.length;
                if (pasted.length > maxRemaining) {
                    pasted = pasted.substring(0, maxRemaining);
                }
                // insert at cursor
                let start = input.selectionStart;
                let end = input.selectionEnd;
                let before = input.value.substring(0, start);
                let after = input.value.substring(end);
                input.value = before + pasted + after;
                input.selectionStart = input.selectionEnd = start + pasted.length;
                // trigger input event for UI updates
                input.dispatchEvent(new Event('input'));
            });

            // block drag & drop into input
            input.addEventListener('drop', function(e) {
                e.preventDefault();
            });
            input.addEventListener('dragover', function(e) {
                e.preventDefault();
            });

            // clear button
            clearBtn.addEventListener('click', function() {
                input.value = '';
                clearError();
                updateBtn();
                updateClearBtn();
                updateCharCount();
                inputType.textContent = '';
                input.focus();
            });

            // enter key submits
            input.addEventListener('keydown', function(e) {
                if (e.key == 'Enter') {
                    e.preventDefault();
                    form.dispatchEvent(new Event('submit'));
                }
            });

            // --- FORM SUBMIT ---

            form.addEventListener('submit', function(e) {
                e.preventDefault();

                // anti-bot: honeypot check
                if (honeypot.value != '') {
                    // silently ignore — likely a bot
                    return;
                }

                // anti-bot: too fast submission (under 1 second)
                if (Date.now() - pageLoadTime < 1000) {
                    return;
                }

                // prevent double submit
                if (submitting) return;

                // rate limit check
                let now = Date.now();
                if (now < lockoutUntil) {
                    let secs = Math.ceil((lockoutUntil - now) / 1000);
                    showError('Too many attempts. Try again in ' + secs + 's.');
                    shakeInput();
                    return;
                }

                let val = sanitize(stripControlChars(input.value.trim()));
                if (val == null || val == '') {
                    showError('Please enter a username, email or phone number.');
                    shakeInput();
                    return;
                }

                let err = validate(val);
                if (err) {
                    showError(err);
                    shakeInput();
                    return;
                }

                // track attempts
                attempts++;
                saveLockoutState();
                if (attempts >= 5) {
                    lockoutUntil = now + 60000;
                    attempts = 0;
                    saveLockoutState();
                    startLockoutCountdown();
                    shakeInput();
                    return;
                }

                // show loading — prevent double submit
                submitting = true;
                btn.textContent = 'Sending...';
                btn.disabled = true;
                input.disabled = true;
                clearBtn.style.display = 'none';
                clearError();

                setTimeout(function() {
                    submitting = false;
                    btn.textContent = 'Continue';
                    input.disabled = false;
                    updateBtn();
                    updateClearBtn();

                    // show success
                    clearError();
                    let successMsg = document.createElement('div');
                    successMsg.className = 'fp-success';
                    successMsg.textContent = 'If an account exists with that information, you will receive a reset link.';
                    let existing = document.querySelector('.fp-success');
                    if (existing) existing.remove();
                    form.appendChild(successMsg);

                    // auto-hide success message after 8 seconds
                    setTimeout(function() {
                        if (successMsg.parentNode) {
                            successMsg.remove();
                        }
                    }, 8000);
                }, 1500);
            });

            // initial state
            updateBtn();
            updateClearBtn();
            updateCharCount();
        })();
    </script>
</body>
</html>
